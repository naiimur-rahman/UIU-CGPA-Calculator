<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIU CGPA & Probation Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --body-bg: #f7f8fc;
            --body-bg-image: none;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-tertiary: #4b5563;
            --card-bg: rgba(255, 255, 255, 1);
            --card-border: transparent;
            --card-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1);
            --form-bg: #f7f8fc;
            --form-border: #e5e7eb;
            --input-bg: rgba(255, 255, 255, 1);
            --input-border: #d1d5db;
            --input-text: #000000;
            --course-item-bg: rgba(255, 255, 255, 1);
            --placeholder-bg: rgba(243, 244, 246, 0.8);
            --footer-text: #6b7280;
        }

        body[data-theme="dark"] {
            --body-bg: #000;
            --body-bg-image: url('https://www.uiu.ac.bd/wp-content/uploads/2022/11/UIU-Permanent-Campus-2.jpg');
            --text-primary: #f0f0f0;
            --text-secondary: #b0b0b0;
            --text-tertiary: #d1d5db;
            --card-bg: rgba(0, 0, 0, 0.5);
            --card-border: rgba(255, 255, 255, 0.1);
            --card-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.6);
            --form-bg: rgba(0, 0, 0, 0.5);
            --form-border: rgba(255, 255, 255, 0.05);
            --input-bg: rgba(30, 30, 30, 0.7);
            --input-border: #4a4a4a;
            --input-text: #ffffff;
            --course-item-bg: rgba(40, 40, 40, 0.6);
            --placeholder-bg: rgba(20, 20, 20, 0.5);
            --footer-text: #d1d5db;
        }

        body {
            font-family: 'Poppins', 'Hind Siliguri', sans-serif;
            background-color: var(--body-bg);
            background-image: var(--body-bg-image);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-primary);
            transition: background-color 0.3s ease;
        }
        .card {
            background-color: var(--card-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 2.5rem 1.5rem; /* Responsive padding */
            box-shadow: var(--card-shadow);
            position: relative;
        }
        @media (min-width: 640px) {
            .card {
                padding: 40px;
            }
        }
        .form-section {
             background-color: var(--form-bg);
             border: 1px solid var(--form-border);
             border-radius: 16px;
             padding: 24px;
             margin-bottom: 24px;
        }
        .form-input, .form-select {
            border-radius: 12px;
            border: 1px solid var(--input-border);
            padding: 10px 14px;
            transition: all 0.2s ease;
            background-color: var(--input-bg);
            color: var(--input-text);
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.4);
        }
        .btn {
            border-radius: 12px;
            font-weight: 600;
            padding: 12px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #10b981;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #059669;
        }
        .btn-main-calc {
            background-image: linear-gradient(to right, #4f46e5, #6366f1);
            color: white;
            padding: 16px;
            font-size: 1.125rem;
            box-shadow: 0 4px 15px -5px rgba(79, 70, 229, 0.6);
        }
        .btn-main-calc:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px -5px rgba(79, 70, 229, 0.7);
        }

        .fade-in-scale {
            animation: fadeInScale 0.5s ease-in-out forwards;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .result-card { display: none; }
        
        .text-primary-color { color: var(--text-primary); }
        .text-secondary-color { color: var(--text-secondary); }
        .text-tertiary-color { color: var(--text-tertiary); }
        .course-list-placeholder-bg { background-color: var(--placeholder-bg); }
        .course-item-bg { background-color: var(--course-item-bg); }
        
        /* Light Mode Result Cards */
        .result-good-light { background: linear-gradient(to bottom right, #f0fdfa, #ccfbf1); border-color: #5eead4; }
        .result-mid-light { background: linear-gradient(to bottom right, #fffbeb, #fef3c7); border-color: #fcd34d; }
        .result-low-light { background: linear-gradient(to bottom right, #fef2f2, #fee2e2); border-color: #fca5a5; }
        .planner-good-light { background-color: rgba(204, 251, 241, 0.5); border-color: #a7f3d0; }
        .planner-mid-light { background-color: rgba(254, 243, 199, 0.5); border-color: #fde68a; }
        .planner-low-light { background-color: rgba(254, 226, 226, 0.5); border-color: #fecaca; }

        /* Dark Mode Result Cards */
        body[data-theme="dark"] .result-good-dark { background: linear-gradient(to bottom right, rgba(20, 70, 40, 0.8), rgba(30, 100, 60, 0.8)); border-color: rgba(40, 150, 80, 0.4); }
        body[data-theme="dark"] .result-mid-dark { background: linear-gradient(to bottom right, rgba(70, 50, 20, 0.8), rgba(100, 70, 30, 0.8)); border-color: rgba(150, 110, 40, 0.4); }
        body[data-theme="dark"] .result-low-dark { background: linear-gradient(to bottom right, rgba(70, 20, 20, 0.8), rgba(100, 30, 30, 0.8)); border-color: rgba(150, 40, 40, 0.4); }
        body[data-theme="dark"] .planner-good-dark { background-color: rgba(20, 70, 40, 0.5); border-color: rgba(40, 150, 80, 0.3); }
        body[data-theme="dark"] .planner-mid-dark { background-color: rgba(70, 50, 20, 0.5); border-color: rgba(150, 110, 40, 0.3); }
        body[data-theme="dark"] .planner-low-dark { background-color: rgba(70, 20, 20, 0.5); border-color: rgba(150, 40, 40, 0.3); }

        /* Notification Snackbar Styles */
        .notification {
            background-color: #22c55e; /* Green */
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem; /* 8px */
            transform: translateX(120%);
            transition: transform 0.4s ease-in-out;
            margin-bottom: 0.5rem;
        }
        body[data-theme="dark"] .notification {
            background-color: #16a34a; /* Darker green */
        }
        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body class="min-h-screen">

    <div id="notification-container" class="fixed top-5 right-5 z-50">
        <!-- Notifications will be dynamically added here -->
    </div>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="w-full max-w-3xl mx-auto card">
             <div class="absolute top-4 right-4 flex items-center space-x-2">
                 <span id="theme-text" class="text-sm font-medium text-secondary-color"></span>
                 <label for="theme-toggle-checkbox" class="relative inline-flex items-center cursor-pointer">
                   <input type="checkbox" id="theme-toggle-checkbox" class="sr-only peer">
                   <div class="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                 </label>
             </div>
            
            <div class="text-center mb-10">
                <h1 class="text-3xl md:text-4xl font-extrabold text-primary-color">UIU CGPA Calculator</h1>
                <p class="text-secondary-color font-medium mt-2">Instantly calculate your CGPA and plan your academic future.</p>
            </div>

            <!-- Current Standing Section --><div class="form-section">
                <h2 class="text-xl font-bold text-primary-color mb-4">Current Academic Standing <span class="text-sm font-normal text-secondary-color">(Optional)</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="current-cgpa" class="block text-sm font-medium text-tertiary-color mb-2">Current CGPA</label>
                        <input type="number" id="current-cgpa" step="0.01" min="0.00" max="4.00" class="w-full form-input" placeholder="e.g., 3.50">
                        <p id="cgpa-error" class="text-red-500 text-sm mt-2 hidden"></p>
                    </div>
                    <div>
                        <label for="completed-credits" class="block text-sm font-medium text-tertiary-color mb-2">Completed Credits</label>
                        <input type="number" id="completed-credits" step="0.5" min="0" class="w-full form-input" placeholder="e.g., 90">
                    </div>
                </div>
            </div>

            <!-- Add New Courses Section --><div class="form-section">
                <h2 class="text-xl font-bold text-primary-color mb-4">This Trimester's Courses</h2>
                <form id="add-course-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <div>
                        <label for="course-credit" class="block text-sm font-medium text-tertiary-color mb-2">Credit Hours</label>
                        <select id="course-credit" class="w-full form-select">
                            <option value="3">3 Credits</option>
                            <option value="2">2 Credits</option>
                            <option value="1">1 Credit</option>
                        </select>
                    </div>
                    <div>
                        <label for="course-grade" class="block text-sm font-medium text-tertiary-color mb-2">Grade</label>
                        <select id="course-grade" class="w-full form-select">
                            <option value="4.00">A (4.00)</option>
                            <option value="3.67">A- (3.67)</option>
                            <option value="3.33">B+ (3.33)</option>
                            <option value="3.00">B (3.00)</option>
                            <option value="2.67">B- (2.67)</option>
                            <option value="2.33">C+ (2.33)</option>
                            <option value="2.00">C (2.00)</option>
                            <option value="1.67">C- (1.67)</option>
                            <option value="1.33">D+ (1.33)</option>
                            <option value="1.00">D (1.00)</option>
                            <option value="0.00">F (0.00)</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full btn btn-primary"><i data-lucide="plus-circle" class="w-5 h-5"></i>Add Course</button>
                </form>
            </div>

            <!-- Add Retake Courses Section --><div class="form-section">
                <h2 class="text-xl font-bold text-primary-color mb-4">Retake Courses <span class="text-sm font-normal text-secondary-color">(Optional)</span></h2>
                <form id="add-retake-form" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                    <div>
                        <label for="retake-credit" class="block text-sm font-medium text-tertiary-color mb-2">Credits</label>
                        <select id="retake-credit" class="w-full form-select">
                            <option value="3">3</option>
                            <option value="2">2</option>
                            <option value="1">1</option>
                        </select>
                    </div>
                    <div>
                        <label for="retake-old-grade" class="block text-sm font-medium text-tertiary-color mb-2">Old Grade</label>
                        <select id="retake-old-grade" class="w-full form-select">
                            <option value="3.67">A- (3.67)</option>
                            <option value="3.33">B+ (3.33)</option>
                            <option value="3.00">B (3.00)</option>
                            <option value="2.67">B- (2.67)</option>
                            <option value="2.33">C+ (2.33)</option>
                            <option value="2.00">C (2.00)</option>
                            <option value="1.67">C- (1.67)</option>
                            <option value="1.33">D+ (1.33)</option>
                            <option value="1.00">D (1.00)</option>
                            <option value="0.00" selected>F (0.00)</option>
                        </select>
                    </div>
                     <div>
                        <label for="retake-new-grade" class="block text-sm font-medium text-tertiary-color mb-2">New Grade</label>
                        <select id="retake-new-grade" class="w-full form-select">
                            <option value="4.00">A (4.00)</option>
                            <option value="3.67">A- (3.67)</option>
                            <option value="3.33">B+ (3.33)</option>
                            <option value="3.00">B (3.00)</option>
                            <option value="2.67">B- (2.67)</option>
                            <option value="2.33">C+ (2.33)</option>
                            <option value="2.00">C (2.00)</option>
                            <option value="1.67">C- (1.67)</option>
                            <option value="1.33">D+ (1.33)</option>
                            <option value="1.00">D (1.00)</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full btn btn-secondary"><i data-lucide="repeat" class="w-5 h-5"></i>Add Retake</button>
                </form>
            </div>

            <!-- Course List --><div id="course-list-container" class="max-h-80 overflow-y-auto pr-2 space-y-3 my-8">
                <!-- Courses will be dynamically added here --></div>

            <!-- Calculate Button --><button id="calculate-cgpa" class="w-full btn btn-main-calc"><i data-lucide="calculator" class="w-6 h-6"></i>Calculate CGPA</button>
            <p id="calc-error" class="text-red-500 text-sm mt-2 text-center hidden"></p>
            
            <!-- Result Section --><div id="result-section" class="mt-8">
                <!-- Good Standing Result --><div id="result-good" class="result-card w-full">
                    <div class="result-good-light result-good-dark border rounded-xl p-6 text-center">
                        <h3 id="good-standing-title" class="text-2xl font-bold text-green-800 mb-4">Tukhor Student!</h3>
                        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:divide-x-2 divide-green-200/50">
                            <div class="flex-1 px-4">
                                <p class="text-green-600 text-lg">Your new CGPA is</p>
                                <p id="cgpa-good" class="text-4xl sm:text-5xl md:text-6xl font-bold text-green-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">Total Credits: <span id="total-credits-good">0</span></p>
                            </div>
                            <div class="flex-1 px-4 pt-4 md:pt-0 border-t-2 md:border-t-0 border-green-200/50">
                                <p class="text-green-600 text-lg">Trimester GPA</p>
                                <p id="tgpa-good" class="text-4xl sm:text-5xl md:text-6xl font-bold text-green-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">This Trimester</p>
                            </div>
                        </div>
                    </div>
                      <!-- Target CGPA Planner --><div id="target-planner-good" class="mt-6 w-full planner-good-light planner-good-dark p-4 rounded-lg border">
                          <h4 class="text-lg font-semibold text-primary-color text-center">Target CGPA Planner</h4>
                          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                              <div>
                                  <label for="target-cgpa-good" class="block text-sm font-medium text-tertiary-color mb-1">Target CGPA</label>
                                  <input type="number" id="target-cgpa-good" step="0.01" min="0.00" max="4.00" class="w-full form-input" placeholder="e.g., 3.75">
                              </div>
                              <div>
                                  <label for="target-credits-good" class="block text-sm font-medium text-tertiary-color mb-1">Next Trimester Credits</label>
                                  <input type="number" id="target-credits-good" min="6" step="0.5" class="w-full form-input" placeholder="e.g., 9 (min 6)">
                              </div>
                          </div>
                          <div id="target-result-good" class="mt-4 text-center hidden">
                              <p class="text-tertiary-color">To reach your target, you need a GPA of:</p>
                              <p id="required-gpa-good" class="text-3xl font-bold text-green-600"></p>
                          </div>
                      </div>
                </div>

                <!-- Mid Standing Result --><div id="result-mid" class="result-card w-full">
                    <div class="result-mid-light result-mid-dark border rounded-xl p-6 text-center">
                        <h3 id="mid-standing-title" class="text-2xl font-bold text-orange-800 mb-4">Keep Pushing!</h3>
                        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:divide-x-2 divide-orange-200/50">
                            <div class="flex-1 px-4">
                                <p class="text-orange-600 text-lg">Your new CGPA is</p>
                                <p id="cgpa-mid" class="text-4xl sm:text-5xl md:text-6xl font-bold text-orange-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">Total Credits: <span id="total-credits-mid">0</span></p>
                            </div>
                            <div class="flex-1 px-4 pt-4 md:pt-0 border-t-2 md:border-t-0 border-orange-200/50">
                                <p class="text-orange-600 text-lg">Trimester GPA</p>
                                <p id="tgpa-mid" class="text-4xl sm:text-5xl md:text-6xl font-bold text-orange-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">This Trimester</p>
                            </div>
                        </div>
                    </div>
                      <!-- Target CGPA Planner --><div id="target-planner-mid" class="mt-6 w-full planner-mid-light planner-mid-dark p-4 rounded-lg border">
                          <h4 class="text-lg font-semibold text-primary-color text-center">Target CGPA Planner</h4>
                          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                              <div>
                                  <label for="target-cgpa-mid" class="block text-sm font-medium text-tertiary-color mb-1">Target CGPA</label>
                                  <input type="number" id="target-cgpa-mid" step="0.01" min="0.00" max="4.00" class="w-full form-input" placeholder="e.g., 3.00">
                              </div>
                              <div>
                                  <label for="target-credits-mid" class="block text-sm font-medium text-tertiary-color mb-1">Next Trimester Credits</label>
                                  <input type="number" id="target-credits-mid" min="6" step="0.5" class="w-full form-input" placeholder="e.g., 12 (min 6)">
                              </div>
                          </div>
                          <div id="target-result-mid" class="mt-4 text-center hidden">
                              <p class="text-tertiary-color">To reach your target, you need a GPA of:</p>
                              <p id="required-gpa-mid" class="text-3xl font-bold text-orange-600"></p>
                          </div>
                      </div>
                </div>
                
                <!-- Low CGPA Result --><div id="result-low" class="result-card w-full">
                    <div class="result-low-light result-low-dark border rounded-xl p-6 text-center">
                         <h3 id="low-cgpa-title" class="text-2xl font-bold text-red-800 mb-4">Probation!</h3>
                        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:divide-x-2 divide-red-200/50">
                            <div class="flex-1 px-4">
                                <p class="text-red-600 text-lg">Your new CGPA is</p>
                                <p id="cgpa-low" class="text-4xl sm:text-5xl md:text-6xl font-bold text-red-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">Total Credits: <span id="total-credits-low">0</span></p>
                            </div>
                            <div class="flex-1 px-4 pt-4 md:pt-0 border-t-2 md:border-t-0 border-red-200/50">
                                <p class="text-red-600 text-lg">Trimester GPA</p>
                                <p id="tgpa-low" class="text-4xl sm:text-5xl md:text-6xl font-bold text-red-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">This Trimester</p>
                            </div>
                        </div>
                    </div>
                      <!-- Recovery Planner --><div id="recovery-planner" class="mt-6 w-full planner-low-light planner-low-dark p-4 rounded-lg border">
                          <h4 class="text-lg font-semibold text-primary-color text-center">Recovery Plan</h4>
                          <p class="text-center text-secondary-color mb-4">Let's find out what you need in your next trimester.</p>
                          
                          <div class="max-w-xs mx-auto">
                              <label for="next-credits" class="block text-sm font-medium text-tertiary-color mb-1">Next trimester's total credits:</label>
                              <input type="number" id="next-credits" min="6" step="0.5" class="w-full form-input" placeholder="e.g., 9 (min 6)">
                          </div>

                          <div id="recovery-result" class="mt-4 text-center hidden">
                              <p class="text-tertiary-color">To reach a 2.0 CGPA, you need a GPA of:</p>
                              <p id="required-gpa" class="text-3xl font-bold text-red-600"></p>
                          </div>
                      </div>
                </div>
            </div>
        </div>
        <footer class="text-center mt-8 text-sm text-secondary-color font-semibold">
            <p>Developed by Naimur Rahman (CSE 242) for the students of UIU‚ù§Ô∏è</p>
        </footer>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            const themeToggle = document.getElementById('theme-toggle-checkbox');
            const themeText = document.getElementById('theme-text');
            const body = document.body;

            const updateTheme = (isDark) => {
                if (isDark) {
                    body.setAttribute('data-theme', 'dark');
                    themeText.textContent = 'Dark Mode';
                    themeToggle.checked = true;
                } else {
                    body.setAttribute('data-theme', 'light');
                    themeText.textContent = 'Light Mode';
                    themeToggle.checked = false;
                }
            };

            const setInitialTheme = () => {
                const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                updateTheme(prefersDark);
            };

            themeToggle.addEventListener('change', () => {
                updateTheme(themeToggle.checked);
            });

            setInitialTheme();

            // --- New Notification Function ---
            function showNotification(message, type = 'success') {
                const container = document.getElementById('notification-container');
                const notification = document.createElement('div');
                notification.className = 'notification';

                if (type === 'error') {
                    notification.style.backgroundColor = '#ef4444'; // Red-500
                    notification.innerHTML = `<i data-lucide="alert-circle" class="w-5 h-5"></i><span>${message}</span>`;
                } else { // success
                    notification.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5"></i><span>${message}</span>`;
                }
                
                container.appendChild(notification);
                lucide.createIcons();

                setTimeout(() => {
                    notification.classList.add('show');
                }, 10);

                setTimeout(() => {
                    notification.classList.remove('show');
                    notification.addEventListener('transitionend', () => notification.remove());
                }, 3000); // Hide after 3 seconds
            }

            const currentCgpaInput = document.getElementById('current-cgpa');
            const completedCreditsInput = document.getElementById('completed-credits');
            const cgpaErrorEl = document.getElementById('cgpa-error');
            const calcErrorEl = document.getElementById('calc-error');
            
            const addCourseForm = document.getElementById('add-course-form');
            const courseCreditEl = document.getElementById('course-credit');
            const courseGradeEl = document.getElementById('course-grade');

            const addRetakeForm = document.getElementById('add-retake-form');
            const retakeCreditEl = document.getElementById('retake-credit');
            const retakeOldGradeEl = document.getElementById('retake-old-grade');
            const retakeNewGradeEl = document.getElementById('retake-new-grade');
            
            const courseListContainer = document.getElementById('course-list-container');
            const calculateBtn = document.getElementById('calculate-cgpa');
            
            const resultGood = document.getElementById('result-good');
            const resultMid = document.getElementById('result-mid');
            const resultLow = document.getElementById('result-low');
            const allResultCards = document.querySelectorAll('.result-card');

            const recoveryPlannerEl = document.getElementById('recovery-planner');
            const targetPlannerGoodEl = document.getElementById('target-planner-good');
            const targetPlannerMidEl = document.getElementById('target-planner-mid');
            
            const nextCreditsInput = document.getElementById('next-credits');
            const recoveryResultEl = document.getElementById('recovery-result');
            const requiredGpaEl = document.getElementById('required-gpa');

            const targetCgpaGoodInput = document.getElementById('target-cgpa-good');
            const targetCreditsGoodInput = document.getElementById('target-credits-good');
            const targetResultGoodEl = document.getElementById('target-result-good');
            const requiredGpaGoodEl = document.getElementById('required-gpa-good');
            
            const targetCgpaMidInput = document.getElementById('target-cgpa-mid');
            const targetCreditsMidInput = document.getElementById('target-credits-mid');
            const targetResultMidEl = document.getElementById('target-result-mid');
            const requiredGpaMidEl = document.getElementById('required-gpa-mid');

            let courses = [];
            let totalGpaCredits = 0; 
            let currentTotalPoints = 0;
            let finalCgpa = 0;

            addCourseForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const credit = parseFloat(courseCreditEl.value);
                const grade = parseFloat(courseGradeEl.value);
                courses.push({ type: 'new', credit, grade });
                renderCourses();
                hideResults();
                showNotification('Course added successfully!'); // Notification call
            });

            addRetakeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const credit = parseFloat(retakeCreditEl.value);
                const oldGrade = parseFloat(retakeOldGradeEl.value);
                const newGrade = parseFloat(retakeNewGradeEl.value);
                if (oldGrade >= newGrade) {
                    showNotification("New grade must be higher than the old grade.", 'error'); // Using notification for error
                    return;
                }
                courses.push({ type: 'retake', credit, oldGrade, newGrade });
                renderCourses();
                hideResults();
                showNotification('Retake course added successfully!'); // Notification call
            });

            function getGradeLetter(grade) {
                const gradeMap = {4.00: 'A', 3.67: 'A-', 3.33: 'B+', 3.00: 'B', 2.67: 'B-', 2.33: 'C+', 2.00: 'C', 1.67: 'C-', 1.33: 'D+', 1.00: 'D', 0.00: 'F'};
                return gradeMap[grade] || '';
            }
            
            function renderCourses() {
                courseListContainer.innerHTML = '';
                if (courses.length === 0) {
                    courseListContainer.innerHTML = `<div class="text-center text-secondary-color p-4 course-list-placeholder-bg rounded-lg"><p>No courses added for this trimester yet.</p></div>`;
                    return;
                }

                courses.forEach((course, index) => {
                    const courseEl = document.createElement('div');
                    let courseHTML = '';
                    let borderColor = 'border-gray-200';

                    if (course.type === 'new') {
                        borderColor = 'border-l-4 border-blue-500';
                        courseHTML = `
                            <div class="flex-grow">
                                <p class="font-semibold text-tertiary-color">${course.credit} Credits</p>
                            </div>
                            <div class="text-center">
                                <span class="font-bold text-lg text-blue-400">${getGradeLetter(course.grade)}</span>
                                <span class="block text-xs text-secondary-color">(${course.grade.toFixed(2)})</span>
                            </div>`;
                    } else { 
                        borderColor = 'border-l-4 border-indigo-500';
                        courseHTML = `
                            <div class="flex-grow">
                                <p class="font-semibold text-tertiary-color">${course.credit} Credits <span class="font-bold text-indigo-400">(Retake)</span></p>
                            </div>
                            <div class="text-center">
                                <span class="font-bold text-secondary-color line-through">${getGradeLetter(course.oldGrade)}</span>
                                <i data-lucide="arrow-right" class="inline-block w-4 h-4 text-secondary-color mx-1"></i>
                                <span class="font-bold text-lg text-green-400">${getGradeLetter(course.newGrade)}</span>
                            </div>`;
                    }
                    
                    courseEl.className = `flex justify-between items-center p-4 rounded-lg shadow-sm border ${borderColor} course-item-bg`;
                    courseEl.innerHTML = courseHTML + `
                        <button class="remove-btn text-red-500 hover:text-red-700 hover:bg-red-100 dark:hover:bg-red-900/50 p-2 rounded-full transition-colors" data-index="${index}">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>`;
                    
                    courseListContainer.appendChild(courseEl);
                });
                lucide.createIcons();
            }

            renderCourses();

            courseListContainer.addEventListener('click', (e) => {
                const removeBtn = e.target.closest('.remove-btn');
                if (removeBtn) {
                    const index = parseInt(removeBtn.dataset.index);
                    courses.splice(index, 1);
                    renderCourses();
                    hideResults();
                }
            });

            function hideResults() {
                allResultCards.forEach(card => card.style.display = 'none');
                allResultCards.forEach(card => card.classList.remove('fade-in-scale'));
                recoveryPlannerEl.style.display = 'none';
                targetPlannerGoodEl.style.display = 'none';
                targetPlannerMidEl.style.display = 'none';
                cgpaErrorEl.classList.add('hidden');
                calcErrorEl.classList.add('hidden');
            }

            calculateBtn.addEventListener('click', () => {
                hideResults();
                
                if (courses.length === 0) {
                    calcErrorEl.textContent = "Please add at least one course to calculate.";
                    calcErrorEl.classList.remove('hidden');
                    return;
                }

                let initialPoints = 0;
                let initialEarnedCredits = 0;
                const currentCgpa = parseFloat(currentCgpaInput.value);
                const completedCredits = parseFloat(completedCreditsInput.value);

                if (currentCgpaInput.value && (currentCgpa > 4.00 || currentCgpa < 0)) {
                    cgpaErrorEl.textContent = "Aeh! üôÇ";
                    cgpaErrorEl.classList.remove('hidden');
                    return;
                }
                
                let trimesterCreditsForValidation = courses.reduce((sum, course) => sum + course.credit, 0);
                if (courses.length > 0 && trimesterCreditsForValidation < 6) {
                    calcErrorEl.textContent = "Current trimester courses must be at least 6 credits to calculate.";
                    calcErrorEl.classList.remove('hidden');
                    return;
                }

                const hasInitialStanding = !isNaN(currentCgpa) && !isNaN(completedCredits) && currentCgpa >= 0 && completedCredits > 0;

                if (hasInitialStanding) {
                    initialPoints = currentCgpa * completedCredits;
                    initialEarnedCredits = completedCredits;
                }

                let newPoints = 0;
                let newGpaCredits = 0;
                let newEarnedCredits = 0;
                let retakePointDifference = 0;
                let retakeEarnedCredits = 0;
                
                let trimesterPoints = 0;
                let trimesterGpaCredits = 0;

                courses.forEach(course => {
                    trimesterGpaCredits += course.credit;
                    const currentCourseGrade = course.type === 'new' ? course.grade : course.newGrade;
                    trimesterPoints += course.credit * currentCourseGrade;

                    // If it's a new course OR if no initial standing is provided, treat it as a new addition.
                    if (course.type === 'new' || !hasInitialStanding) {
                        newGpaCredits += course.credit;
                        if (currentCourseGrade > 0.00) {
                            newEarnedCredits += course.credit;
                        }
                        newPoints += course.credit * currentCourseGrade;
                    } else if (course.type === 'retake' && hasInitialStanding) {
                        // Handle retakes only if there's an initial standing
                        if (course.oldGrade === 0.00) {
                            // This was an 'F', so new credits are added to the total GPA credits
                            newGpaCredits += course.credit; 
                            // It also contributes to earned credits now
                            retakeEarnedCredits += course.credit;
                        }
                        // The change in points affects the total points
                        retakePointDifference += (course.newGrade - course.oldGrade) * course.credit;
                    }
                });

                totalGpaCredits = initialEarnedCredits + newGpaCredits; 
                let totalEarnedCreditsForDisplay = initialEarnedCredits + newEarnedCredits + retakeEarnedCredits;
                currentTotalPoints = initialPoints + newPoints + retakePointDifference;
                
                finalCgpa = (totalGpaCredits === 0) ? 0 : currentTotalPoints / totalGpaCredits;
                const trimesterGpa = (trimesterGpaCredits === 0) ? 0 : trimesterPoints / trimesterGpaCredits;

                let targetResultCard;
                
                if (finalCgpa >= 3.0) {
                    targetResultCard = resultGood;
                    if (finalCgpa.toFixed(2) !== '4.00') {
                        targetPlannerGoodEl.style.display = 'block';
                    }
                    const titleEl = document.getElementById('good-standing-title');
                    if (finalCgpa >= 3.8) titleEl.textContent = "‡¶§‡ßÅ‡¶ñ‡ßã‡¶°‡¶º ‡¶á‡¶∂‡¶ü‡ßÅ‡¶°‡ßá‡¶®‡ßç‡¶ü! üéì";
                    else if (finalCgpa >= 3.5) titleEl.textContent = "‡¶ì‡¶Ø‡¶º‡ßá‡¶≠‡¶æ‡¶∞‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ! üí∏";
                    else if (finalCgpa >= 3.2) titleEl.textContent = "‡¶∏‡ßá‡¶á‡¶´ ‡¶ú‡ßã‡¶®‡ßá ‡¶Ü‡¶õ‡ßá‡¶® üòå";
                    else titleEl.textContent = "‡¶∏‡¶ø‡¶ú‡¶ø ‡ß©.‡ß¶‡ß¶ ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡ßá‡¶®! üòÖ";
                    document.getElementById('cgpa-good').textContent = finalCgpa.toFixed(2);
                    document.getElementById('total-credits-good').textContent = totalEarnedCreditsForDisplay.toFixed(2).replace(/\.00$/, '');
                    document.getElementById('tgpa-good').textContent = trimesterGpa.toFixed(2);
                } else if (finalCgpa >= 2.0) {
                    targetResultCard = resultMid;
                    targetPlannerMidEl.style.display = 'block';
                    const titleEl = document.getElementById('mid-standing-title');
                    if (finalCgpa >= 2.6) titleEl.textContent = "‡¶Ü‡¶∞‡ßá‡¶ï‡¶ü‡ßÅ ‡¶™‡¶∞‡¶ø‡¶∂‡ßç‡¶∞‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®! üí™";
                    else if (finalCgpa >= 2.2) titleEl.textContent = "‡¶∞‡ßá‡¶° ‡¶ú‡ßã‡¶®‡ßá ‡¶Ü‡¶õ‡ßá‡¶®! üö®";
                    else titleEl.textContent = "‡¶Ü‡¶∞‡ßá‡¶ï‡¶ü‡ßÅ ‡¶π‡¶≤‡ßá‡¶á ‡¶≤‡ßá‡¶ü‡¶æ‡¶∞ ‡¶ß‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡ßá‡¶¨‡ßá! üìâ";
                    document.getElementById('cgpa-mid').textContent = finalCgpa.toFixed(2);
                    document.getElementById('total-credits-mid').textContent = totalEarnedCreditsForDisplay.toFixed(2).replace(/\.00$/, '');
                    document.getElementById('tgpa-mid').textContent = trimesterGpa.toFixed(2);
                } else {
                    targetResultCard = resultLow;
                    recoveryPlannerEl.style.display = 'block';
                    const lowTitleEl = document.getElementById('low-cgpa-title');
                    if (finalCgpa < 1.5) lowTitleEl.textContent = "RIP üíÄ";
                    else lowTitleEl.textContent = "‡¶ú‡¶ò‡¶®‡ßç‡¶Ø ‡¶∞‡¶ï‡¶Æ‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶∂‡ßç‡¶∞‡¶Æ‡ßÄ ‡¶π‡¶®! ü§Ø";
                    document.getElementById('cgpa-low').textContent = finalCgpa.toFixed(2);
                    document.getElementById('total-credits-low').textContent = totalEarnedCreditsForDisplay.toFixed(2).replace(/\.00$/, '');
                    document.getElementById('tgpa-low').textContent = trimesterGpa.toFixed(2);
                }
                
                if (targetResultCard) {
                    targetResultCard.style.display = 'block';
                    setTimeout(() => targetResultCard.classList.add('fade-in-scale'), 10);
                    targetResultCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
            
            nextCreditsInput.addEventListener('input', () => {
                const nextCredits = parseFloat(nextCreditsInput.value);
                if (isNaN(nextCredits) || nextCredits < 6) {
                    recoveryResultEl.classList.add('hidden');
                    return;
                }
                const targetTotalPoints = 2.0 * (totalGpaCredits + nextCredits);
                const requiredNextPoints = targetTotalPoints - currentTotalPoints;
                const requiredGpa = requiredNextPoints / nextCredits;
                recoveryResultEl.classList.remove('hidden');
                if (requiredGpa > 4.0) requiredGpaEl.textContent = `Impossible (${requiredGpa.toFixed(2)}).`;
                else if (requiredGpa <= 0) requiredGpaEl.textContent = 'Any passing grade will work!';
                else requiredGpaEl.textContent = requiredGpa.toFixed(2);
            });

            function handleTargetCalculation(targetCgpaInput, targetCreditsInput, resultEl, gpaEl) {
                 const targetCgpa = parseFloat(targetCgpaInput.value);
                 const nextCredits = parseFloat(targetCreditsInput.value);
                
                 if (isNaN(targetCgpa) || isNaN(nextCredits) || nextCredits < 6 || targetCgpa <= finalCgpa || targetCgpa > 4.00) {
                      resultEl.classList.add('hidden');
                      return;
                 }

                 const targetTotalPoints = targetCgpa * (totalGpaCredits + nextCredits);
                 const requiredNextPoints = targetTotalPoints - currentTotalPoints;
                 const requiredGpa = requiredNextPoints / nextCredits;
                 resultEl.classList.remove('hidden');
                 if (requiredGpa > 4.0) gpaEl.textContent = `Impossible (${requiredGpa.toFixed(2)}).`;
                 else if (requiredGpa < 0) gpaEl.textContent = `Already achieved!`;
                 else gpaEl.textContent = requiredGpa.toFixed(2);
            }

            [targetCgpaGoodInput, targetCreditsGoodInput].forEach(el => el.addEventListener('input', () => handleTargetCalculation(targetCgpaGoodInput, targetCreditsGoodInput, targetResultGoodEl, requiredGpaGoodEl)));
            [targetCgpaMidInput, targetCreditsMidInput].forEach(el => el.addEventListener('input', () => handleTargetCalculation(targetCgpaMidInput, targetCreditsMidInput, targetResultMidEl, requiredGpaMidEl)));

        });
    </script>

</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIU CGPA Calculator (Renovated)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --body-bg: #f4f7fa;
            --body-bg-image: none;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-tertiary: #718096;
            --card-bg: rgba(255, 255, 255, 0.9);
            --card-border: #e2e8f0;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --form-bg: #fdfdff;
            --form-border: #e2e8f0;
            --input-bg: #ffffff;
            --input-border: #cbd5e0;
            --input-text: #1a202c;
            --course-item-bg: #ffffff;
            --placeholder-bg: #f7fafc;
            --footer-text: #718096;
            --theme-toggle-bg: #e2e8f0;
            --theme-toggle-icon: #f6ad55;
            --btn-neutral-bg: #f3f4f6;
            --btn-neutral-text: #374151;
            --btn-neutral-hover: #e5e7eb;
            --notification-success-bg: #22c55e;
            --notification-error-bg: #ef4444;
            --notification-info-bg: #3b82f6;
            --notification-warning-bg: #f59e0b;
        }

        body[data-theme="dark"] {
            --body-bg: #121212;
            --body-bg-image: url('https://www.uiu.ac.bd/wp-content/uploads/2022/11/UIU-Permanent-Campus-2.jpg');
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --text-tertiary: #718096;
            --card-bg: rgba(18, 18, 18, 0.7);
            --card-border: rgba(255, 255, 255, 0.1);
            --card-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.6);
            --form-bg: rgba(26, 26, 26, 0.7);
            --form-border: rgba(255, 255, 255, 0.08);
            --input-bg: rgba(30, 30, 30, 0.7);
            --input-border: #4a5568;
            --input-text: #e2e8f0;
            --course-item-bg: rgba(45, 55, 72, 0.6);
            --placeholder-bg: rgba(26, 32, 44, 0.8);
            --footer-text: #a0aec0;
            --theme-toggle-bg: #2d3748;
            --theme-toggle-icon: #4299e1;
            --btn-neutral-bg: #374151;
            --btn-neutral-text: #e5e7eb;
            --btn-neutral-hover: #4b5563;
            --notification-success-bg: #16a34a;
            --notification-error-bg: #dc2626;
            --notification-info-bg: #2563eb;
            --notification-warning-bg: #d97706;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--body-bg);
            background-image: var(--body-bg-image);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-primary);
            transition: background-color 0.3s ease;
        }
        .card {
            background-color: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            position: relative;
            transition: background-color 0.3s, border-color 0.3s;
        }
        @media (min-width: 640px) {
            .card {
                padding: 40px;
            }
        }
        .form-section {
             background-color: var(--form-bg);
             border: 1px solid var(--form-border);
             border-radius: 16px;
             padding: 24px;
             margin-bottom: 24px;
             transition: background-color 0.3s, border-color 0.3s;
        }
        .form-input, .form-select {
            border-radius: 12px;
            border: 1px solid var(--input-border);
            padding: 10px 14px;
            transition: all 0.2s ease;
            background-color: var(--input-bg);
            color: var(--input-text);
            -webkit-appearance: none;
            appearance: none;
        }
        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='currentColor' class='w-5 h-5'%3e%3cpath fill-rule='evenodd' d='M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.25em 1.25em;
            padding-right: 2.5rem;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.4);
        }
        
        /* Hide arrows from number inputs */
        .form-input[type=number] { -moz-appearance: textfield; }
        .form-input[type=number]::-webkit-outer-spin-button,
        .form-input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .btn {
            border-radius: 12px;
            font-weight: 600;
            padding: 12px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            -webkit-tap-highlight-color: transparent;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .btn:active {
            transform: translateY(0px);
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
        }
        .btn-primary { background-color: #4f46e5; color: white; }
        .btn-primary:hover { background-color: #4338ca; }
        .btn-secondary { background-color: #10b981; color: white; }
        .btn-secondary:hover { background-color: #059669; }
        .btn-danger { background-color: #e53e3e; color: white; }
        .btn-danger:hover { background-color: #c53030; }
        .btn-neutral { background-color: var(--btn-neutral-bg); color: var(--btn-neutral-text); }
        .btn-neutral:hover { background-color: var(--btn-neutral-hover); }
        .btn-main-calc {
            background-image: linear-gradient(to right, #4f46e5, #6366f1);
            color: white; padding: 16px; font-size: 1.125rem;
        }

        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            animation-delay: var(--stagger-delay, 0ms);
            opacity: 0;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .result-card { display: none; }
        .text-primary-color { color: var(--text-primary); }
        .text-secondary-color { color: var(--text-secondary); }
        .text-tertiary-color { color: var(--text-tertiary); }
        .course-list-placeholder-bg { background-color: var(--placeholder-bg); }
        .course-item-bg { background-color: var(--course-item-bg); }

        .result-good { background: linear-gradient(to bottom right, #f0fdfa, #ccfbf1); border-color: #5eead4; }
        .result-mid { background: linear-gradient(to bottom right, #fffbeb, #fef3c7); border-color: #fcd34d; }
        .result-low { background: linear-gradient(to bottom right, #fef2f2, #fee2e2); border-color: #fca5a5; }
        .planner-good { background-color: rgba(204, 251, 241, 0.5); border-color: #a7f3d0; }
        .planner-mid { background-color: rgba(254, 243, 199, 0.5); border-color: #fde68a; }
        .planner-low { background-color: rgba(254, 226, 226, 0.5); border-color: #fecaca; }

        body[data-theme="dark"] .result-good { background: linear-gradient(to bottom right, rgba(20, 70, 40, 0.8), rgba(30, 100, 60, 0.8)); border-color: rgba(40, 150, 80, 0.4); }
        body[data-theme="dark"] .result-mid { background: linear-gradient(to bottom right, rgba(70, 50, 20, 0.8), rgba(100, 70, 30, 0.8)); border-color: rgba(150, 110, 40, 0.4); }
        body[data-theme="dark"] .result-low { background: linear-gradient(to bottom right, rgba(70, 20, 20, 0.8), rgba(100, 30, 30, 0.8)); border-color: rgba(150, 40, 40, 0.4); }
        body[data-theme="dark"] .planner-good { background-color: rgba(20, 70, 40, 0.5); border-color: rgba(40, 150, 80, 0.3); }
        body[data-theme="dark"] .planner-mid { background-color: rgba(70, 50, 20, 0.5); border-color: rgba(150, 110, 40, 0.3); }
        body[data-theme="dark"] .planner-low { background-color: rgba(70, 20, 20, 0.5); border-color: rgba(150, 40, 40, 0.3); }

        #notification-container {
            position: fixed; top: 1.25rem; right: 1.25rem; z-index: 150;
        }
        .notification {
            color: white; padding: 1rem 1.5rem;
            border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            display: flex; align-items: center; gap: 0.5rem;
            transform: translateX(120%); transition: transform 0.4s ease-in-out; margin-bottom: 0.5rem;
        }
        .notification.success { background-color: var(--notification-success-bg); }
        .notification.error { background-color: var(--notification-error-bg); }
        .notification.info { background-color: var(--notification-info-bg); }
        .notification.warning { background-color: var(--notification-warning-bg); }
        .notification.show { transform: translateX(0); }
        
        .theme-toggle {
            width: 50px; height: 26px; border-radius: 13px;
            background: var(--theme-toggle-bg);
            cursor: pointer; position: relative;
            transition: background-color 0.3s ease;
        }
        .theme-toggle::before {
            content: '';
            position: absolute;
            top: 3px; left: 3px;
            width: 20px; height: 20px;
            border-radius: 50%;
            background-color: white;
            transition: transform 0.3s ease;
            color: var(--theme-toggle-icon);
            display: grid;
            place-items: center;
        }
        #theme-toggle-checkbox:checked + .theme-toggle::before {
            transform: translateX(24px);
        }

        .confetti-piece {
            position: absolute; width: 8px; height: 16px;
            background: #ffd300; top: 0; opacity: 0;
        }

        .course-item-container {
            border: 1px solid var(--card-border);
            border-radius: 12px;
            background-color: var(--course-item-bg);
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
        }
        body[data-theme="dark"] .course-item-container {
            border-color: rgba(255, 255, 255, 0.1);
        }
        .course-item-container.new-course { border-left: 4px solid #3b82f6; }
        .course-item-container.retake-course { border-left: 4px solid #8b5cf6; }
        
        .error-placeholder {
            min-height: 1.25rem; margin-top: 0.5rem; visibility: hidden; 
        }
        .error-placeholder.visible { visibility: visible; }
        
        /* --- Game Styles --- */
        #open-game-modal {
            position: fixed;
            bottom: 1.5rem; right: 1.5rem;
            z-index: 40;
            background-color: #4f46e5; color: white;
            padding: 1rem; border-radius: 50%;
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4), 0 4px 6px -2px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        #open-game-modal:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 15px 25px -5px rgba(79, 70, 229, 0.5), 0 8px 10px -6px rgba(0,0,0,0.1);
        }
        
        #game-modal {
            position: fixed; inset: 0; z-index: 100;
            display: none; align-items: center; justify-content: center;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            opacity: 0; transition: opacity 0.3s ease;
        }
        #game-modal.show { display: flex; opacity: 1; }
        
        #game-modal-content {
            background-color: var(--card-bg);
            border-radius: 24px;
            border: 1px solid var(--card-border);
            padding: 1rem;
            width: calc(100% - 2rem); max-width: 640px;
            margin: 1rem; max-height: calc(90vh - 2rem);
            overflow-y: auto; position: relative;
            transform: scale(0.95); transition: transform 0.3s ease;
        }
        @media (min-width: 640px) {
             #game-modal-content { padding: 1.5rem; }
        }
        #close-game-modal {
            position: absolute; top: 1rem; right: 1rem;
            background-color: var(--btn-neutral-bg);
            color: var(--btn-neutral-text);
            border-radius: 50%; padding: 0.5rem;
            transition: all 0.2s;
        }
        #close-game-modal:hover {
            background-color: var(--btn-neutral-hover);
            transform: rotate(90deg);
        }
        
        .game-container { display: none; }
        .game-container.active { display: block; }
        .game-status {
            color: var(--text-primary);
            font-size: 1.25rem; font-weight: 600;
            min-height: 1.5em;
        }
        
        /* --- Tic-Tac-Toe --- */
        #tic-tac-toe-board {
            display: grid; grid-template-columns: repeat(3, 1fr);
            width: 100%; max-width: 300px; aspect-ratio: 1 / 1;
            margin: 20px auto; border: 2px solid var(--input-border);
            border-radius: 12px; overflow: hidden;
        }
        .ttt-cell {
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem; font-weight: bold;
            color: var(--text-primary); cursor: pointer;
            border-right: 2px solid var(--input-border);
            border-bottom: 2px solid var(--input-border);
            transition: background-color 0.2s;
            line-height: 1; padding: 0;
            height: 100%; min-height: 60px;
        }
        .ttt-cell > span { visibility: hidden; }
        .ttt-cell.occupied > span { visibility: visible; }
        @media (max-width: 360px) { .ttt-cell { font-size: 2rem; } }
        .ttt-cell:nth-child(3n) { border-right: none; }
        .ttt-cell:nth-child(n+7) { border-bottom: none; }
        .ttt-cell:hover:not(.occupied):not(.disabled) { background-color: var(--form-bg); }
        .ttt-cell.disabled { cursor: not-allowed; }
        .ttt-cell.X > span { color: #4f46e5; }
        .ttt-cell.O > span { color: #10b981; }

        /* --- Memory Match Game --- */
        #memory-difficulty-select { display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.875rem; }
        #memory-board {
            display: grid; gap: 10px;
            width: 100%; max-width: 400px;
            margin: 20px auto; perspective: 1000px;
        }
        .memory-card {
            width: 100%; aspect-ratio: 1 / 1; position: relative;
            transform-style: preserve-3d; transition: transform 0.6s;
            cursor: pointer;
        }
        .memory-card.is-flipped { transform: rotateY(180deg); }
        .memory-card-face {
            position: absolute; width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            display: flex; align-items: center; justify-content: center;
            border-radius: 12px; border: 1px solid var(--input-border);
        }
        .memory-card-front { background-color: var(--form-bg); font-size: 2rem; transform: rotateY(180deg); }
        @media (max-width: 400px) { .memory-card-front { font-size: 1.5rem; } }
        .memory-card-back { background-color: var(--form-bg); color: var(--text-primary); }
        .memory-card-back i { color: var(--text-primary); width: 60%; height: 60%; }
        .memory-card.is-matched { opacity: 0.5; cursor: default; }

        /* --- Snake Game --- */
        #snake-game-container { display: flex; flex-direction: column; align-items: center; gap: 1rem; }
        #snake-canvas {
            background-color: var(--form-bg); border: 2px solid var(--input-border);
            border-radius: 8px; width: 100%;
            max-width: 400px; aspect-ratio: 1 / 1;
        }
        #snake-controls {
            display: grid; grid-template-columns: repeat(3, minmax(60px, 80px));
            grid-template-rows: repeat(2, minmax(60px, 80px));
            gap: 0.5rem; justify-content: center;
        }
        .snake-control-btn {
            background-color: var(--btn-neutral-bg); color: var(--btn-neutral-text);
            border-radius: 50%; font-size: 2rem; border: none; cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            transition: all 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .snake-control-btn:hover { background-color: var(--btn-neutral-hover); transform: translateY(-2px); }
        #snake-up { grid-column: 2 / 3; grid-row: 1 / 2; }
        #snake-left { grid-column: 1 / 2; grid-row: 2 / 3; }
        #snake-right { grid-column: 3 / 4; grid-row: 2 / 3; }
        #snake-down { grid-column: 2 / 3; grid-row: 2 / 3; }
        @media (min-width: 640px) { #snake-controls { display: none; } }

        /* --- Whac-A-Mole --- */
        #wam-board {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;
            width: 100%; max-width: 300px; margin: 20px auto;
        }
        .wam-hole {
            width: 100%; aspect-ratio: 1 / 1;
            background-color: var(--input-border); border-radius: 50%;
            overflow: hidden; position: relative; cursor: pointer;
            border: 5px solid var(--form-bg);
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.2);
        }
        .wam-mole {
            width: 70%; height: 70%; background-color: #8D6E63;
            border-radius: 50%; position: absolute; bottom: -100%;
            left: 15%; transition: bottom 0.2s ease-in-out;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem;
        }
        @media (max-width: 400px) { .wam-mole { font-size: 1.5rem; } }
        .wam-mole.up { bottom: 15%; }
        .wam-hole:active { transform: scale(0.95); }

        /* --- Word Guess Game --- */
        #wg-word-display {
            display: flex; gap: 0.5rem; justify-content: center;
            margin: 1.5rem 0; flex-wrap: wrap;
        }
        .wg-letter {
            font-size: 2rem; font-weight: 600; color: var(--text-primary);
            width: 40px; height: 50px; display: flex;
            align-items: center; justify-content: center;
            border-bottom: 3px solid var(--input-border); line-height: 1;
        }
        #wg-input-area { display: flex; justify-content: center; gap: 0.5rem; margin-top: 1.5rem; }
        #wg-letter-input { width: 60px; font-size: 1.5rem; text-align: center; text-transform: uppercase; }
        #wg-guessed-letters { min-height: 2em; color: var(--text-secondary); margin-top: 1rem; }

        /* --- Breakout Game --- */
        #breakout-game-container { display: flex; flex-direction: column; align-items: center; gap: 1rem; }
        #breakout-canvas {
            background-color: var(--form-bg); border: 2px solid var(--input-border);
            border-radius: 8px; width: 100%; max-width: 480px;
            height: 400px; cursor: none; touch-action: none;
        }
        #breakout-status {
            display: flex; justify-content: space-between;
            width: 100%; max-width: 480px; padding: 0 0.5rem;
        }
        #breakout-controls {
            display: flex; justify-content: space-between;
            width: 100%; max-width: 300px; margin-top: 0.5rem;
        }
        .breakout-control-btn {
            background-color: var(--btn-neutral-bg); color: var(--btn-neutral-text);
            border-radius: 12px; font-size: 1.5rem; border: none;
            cursor: pointer; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            transition: all 0.2s; padding: 0.75rem 1.5rem;
            user-select: none; -webkit-user-select: none;
            touch-action: manipulation; display: flex;
            align-items: center; justify-content: center;
        }
        .breakout-control-btn:hover { background-color: var(--btn-neutral-hover); transform: translateY(-2px); }
        .breakout-control-btn:active { transform: translateY(0px); box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05); }
        @media (min-width: 640px) { #breakout-controls { display: none; } }
    </style>
</head>
<body class="min-h-screen">

    <div id="notification-container"></div>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="w-full max-w-3xl mx-auto card">
            
            <div class="absolute top-4 right-4 flex items-center space-x-3">
                <span id="theme-icon"></span>
                <input type="checkbox" id="theme-toggle-checkbox" class="sr-only">
                <label for="theme-toggle-checkbox" class="theme-toggle"></label>
            </div>
            
            <div class="text-center mb-10">
                <h1 class="text-3xl md:text-4xl font-extrabold text-primary-color">UIU CGPA Calculator</h1>
                <p class="text-secondary-color font-medium mt-2">Instantly calculate your CGPA and plan your academic future.</p>
            </div>

            <div class="mb-8 flex justify-center border-b border-gray-200 dark:border-gray-700">
                <button id="cgpa-tab-btn" class="px-4 py-2 text-sm font-medium text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-500">CGPA Calculator</button>
                <button id="course-grade-tab-btn" class="px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 border-b-2 border-transparent hover:text-gray-700 dark:hover:text-gray-200">Course Grade</button>
                <button id="grading-policy-tab-btn" class="px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 border-b-2 border-transparent hover:text-gray-700 dark:hover:text-gray-200">Grading Policy</button>
            </div>

            <div id="cgpa-calculator-tab">
                <div class="form-section">
                    <h2 class="text-xl font-bold text-primary-color mb-4">Current Academic Standing <span class="text-sm font-normal text-secondary-color">(Optional)</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end"> 
                    <div>
                        <label for="current-cgpa" class="block text-sm font-medium text-tertiary-color mb-2">Current CGPA</label>
                        <input type="number" id="current-cgpa" step="0.01" min="0.00" max="4.00" class="w-full form-input" placeholder="e.g., 3.50">
                        <p id="cgpa-error" class="text-red-500 text-sm error-placeholder"></p>
                    </div>
                    <div>
                        <label for="completed-credits" class="block text-sm font-medium text-tertiary-color mb-2">Total Credits Attempted<br>(Incl. F grades)</label>
                        <input type="number" id="completed-credits" step="0.5" min="0" class="w-full form-input" placeholder="e.g., 90">
                        <p id="attempted-credits-error" class="error-placeholder text-red-500 text-sm"></p>
                    </div>
                    <div>
                        <label for="completed-earned-credits" class="block text-sm font-medium text-tertiary-color mb-2">Total Credits Earned<br>(Before this Tri.)</label>
                        <input type="number" id="completed-earned-credits" step="0.5" min="0" class="w-full form-input" placeholder="e.g., 85">
                        <p id="earned-credits-error" class="error-placeholder text-red-500 text-sm"></p>
                    </div>
                </div>
                <p id="credits-error" class="text-red-500 text-sm text-center hidden"></p>
            </div>

            <div class="form-section">
                <h2 class="text-xl font-bold text-primary-color mb-4">This Trimester's Courses</h2>
                <form id="add-course-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <div>
                        <label for="course-credit" class="block text-sm font-medium text-tertiary-color mb-2">Credit Hours</label>
                        <select id="course-credit" class="w-full form-select">
                            <option value="" selected disabled>Select Credit</option>
                            <option value="3">3 Credits</option>
                            <option value="2">2 Credits</option>
                            <option value="1">1 Credit</option>
                        </select>
                    </div>
                    <div>
                        <label for="course-grade" class="block text-sm font-medium text-tertiary-color mb-2">Expected Grade</label>
                        <select id="course-grade" class="w-full form-select">
                            <option value="" selected disabled>Select Grade</option>
                            <option value="4.00">A (4.00)</option>
                            <option value="3.67">A- (3.67)</option>
                            <option value="3.33">B+ (3.33)</option>
                            <option value="3.00">B (3.00)</option>
                            <option value="2.67">B- (2.67)</option>
                            <option value="2.33">C+ (2.33)</option>
                            <option value="2.00">C (2.00)</option>
                            <option value="1.67">C- (1.67)</option>
                            <option value="1.33">D+ (1.33)</option>
                            <option value="1.00">D (1.00)</option>
                            <option value="0.00">F (0.00)</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full btn btn-primary"><i data-lucide="plus-circle" class="w-5 h-5"></i>Add Course</button>
                </form>
            </div>

            <div class="form-section">
                <h2 class="text-xl font-bold text-primary-color mb-4">Retake Courses <span class="text-sm font-normal text-secondary-color">(Optional)</span></h2>
                <form id="add-retake-form" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                    <div>
                        <label for="retake-credit" class="block text-sm font-medium text-tertiary-color mb-2">Credits</label>
                        <select id="retake-credit" class="w-full form-select">
                            <option value="" selected disabled>Select Credit</option>
                            <option value="3">3</option>
                            <option value="2">2</option>
                            <option value="1">1</option>
                        </select>
                    </div>
                    <div>
                        <label for="retake-old-grade" class="block text-sm font-medium text-tertiary-color mb-2">Old Grade</label>
                        <select id="retake-old-grade" class="w-full form-select">
                            <option value="" selected disabled>Select Old Grade</option>
                            <option value="3.67">A- (3.67)</option>
                            <option value="3.33">B+ (3.33)</option>
                            <option value="3.00">B (3.00)</option>
                            <option value="2.67">B- (2.67)</option>
                            <option value="2.33">C+ (2.33)</option>
                            <option value="2.00">C (2.00)</option>
                            <option value="1.67">C- (1.67)</option>
                            <option value="1.33">D+ (1.33)</option>
                            <option value="1.00">D (1.00)</option>
                            <option value="0.00">F (0.00)</option>
                        </select>
                    </div>
                    <div>
                        <label for="retake-new-grade" class="block text-sm font-medium text-tertiary-color mb-2">New Grade</label>
                        <select id="retake-new-grade" class="w-full form-select">
                            <option value="" selected disabled>Select New Grade</option>
                            <option value="4.00">A (4.00)</option>
                            <option value="3.67">A- (3.67)</option>
                            <option value="3.33">B+ (3.33)</option>
                            <option value="3.00">B (3.00)</option>
                            <option value="2.67">B- (2.67)</option>
                            <option value="2.33">C+ (2.33)</option>
                            <option value="2.00">C (2.00)</option>
                            <option value="1.67">C- (1.67)</option>
                            <option value="1.33">D+ (1.33)</option>
                            <option value="1.00">D (1.00)</option>
                            <option value="0.00">F (0.00)</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full btn btn-secondary"><i data-lucide="repeat" class="w-5 h-5"></i>Add Retake</button>
                </form>
            </div>

            <div id="course-list-container" class="space-y-3 my-8"></div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button id="reset-all" class="w-full btn btn-danger"><i data-lucide="refresh-cw" class="w-6 h-6"></i>Reset All</button>
                <button id="calculate-cgpa" class="w-full btn btn-main-calc"><i data-lucide="calculator" class="w-6 h-6"></i>Calculate CGPA</button>
            </div>
            <p id="calc-error" class="text-red-500 text-sm mt-2 text-center hidden"></p>
            
            <div id="result-section" class="mt-8">
                <div id="result-good" class="result-card w-full">
                    <div class="result-good border rounded-xl p-6 text-center">
                        <h3 id="good-standing-title" class="text-2xl font-bold text-green-800 mb-4">Excellent!</h3>
                        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:divide-x-2 divide-green-200/50">
                            <div class="flex-1 px-4">
                                <p class="text-green-600 text-lg">New CGPA</p>
                                <p id="cgpa-good" class="text-4xl sm:text-5xl md:text-6xl font-bold text-green-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">Total Attempted Credit: <span id="total-credits-good">0</span></p>
                                <p class="text-sm text-secondary-color">Total Completed Credit: <span id="total-earned-credits-good">0</span></p> 
                            </div>
                            <div class="flex-1 px-4 pt-4 md:pt-0 border-t-2 md:border-t-0 border-green-200/50">
                                <p class="text-green-600 text-lg">Trimester GPA</p>
                                <p id="tgpa-good" class="text-4xl sm:text-5xl md:text-6xl font-bold text-green-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">Attempted Credit: <span id="trimester-credits-good">0</span></p> 
                                <p class="text-sm text-secondary-color">Completed Credit: <span id="trimester-earned-credits-good">0</span></p>
                            </div>
                        </div>
                    </div>
                     <div class="mt-6 w-full planner-good p-4 rounded-lg border">
                        <h4 class="text-lg font-semibold text-primary-color text-center">Target CGPA Planner</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 items-start">
                            <div>
                                <label for="target-cgpa-good" class="block text-sm font-medium text-tertiary-color mb-1">Target CGPA</label>
                                <input type="number" id="target-cgpa-good" step="0.01" min="0.00" max="4.00" class="w-full form-input" placeholder="e.g., 3.75">
                                <p id="target-cgpa-good-error" class="text-red-500 text-sm error-placeholder"></p>
                            </div>
                            <div>
                                <label for="target-credits-good" class="block text-sm font-medium text-tertiary-color mb-1">Next Trimester Credits</label>
                                <input type="number" id="target-credits-good" min="0" step="0.5" class="w-full form-input" placeholder="e.g., 9">
                                <p id="target-credits-good-error" class="text-red-500 text-sm error-placeholder"></p>
                            </div>
                        </div>
                        <div id="target-result-good" class="mt-4 text-center hidden">
                            <p class="text-tertiary-color">You'll need a GPA of:</p>
                            <p id="required-gpa-good" class="text-3xl font-bold text-green-600"></p>
                        </div>
                    </div>
                </div>

                <div id="result-mid" class="result-card w-full">
                    <div class="result-mid border rounded-xl p-6 text-center">
                        <h3 id="mid-standing-title" class="text-2xl font-bold text-orange-800 mb-4">Keep Pushing!</h3>
                        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:divide-x-2 divide-orange-200/50">
                            <div class="flex-1 px-4">
                                <p class="text-orange-600 text-lg">New CGPA</p>
                                <p id="cgpa-mid" class="text-4xl sm:text-5xl md:text-6xl font-bold text-orange-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">Total Attempted Credit: <span id="total-credits-mid">0</span></p>
                                <p class="text-sm text-secondary-color">Total Completed Credit: <span id="total-earned-credits-mid">0</span></p>
                            </div>
                            <div class="flex-1 px-4 pt-4 md:pt-0 border-t-2 md:border-t-0 border-orange-200/50">
                                <p class="text-orange-600 text-lg">Trimester GPA</p>
                                <p id="tgpa-mid" class="text-4xl sm:text-5xl md:text-6xl font-bold text-orange-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">Attempted Credit: <span id="trimester-credits-mid">0</span></p>
                                <p class="text-sm text-secondary-color">Completed Credit: <span id="trimester-earned-credits-mid">0</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 w-full planner-mid p-4 rounded-lg border">
                        <h4 class="text-lg font-semibold text-primary-color text-center">Target CGPA Planner</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 items-start">
                            <div>
                                <label for="target-cgpa-mid" class="block text-sm font-medium text-tertiary-color mb-1">Target CGPA</label>
                                <input type="number" id="target-cgpa-mid" step="0.01" min="0.00" max="4.00" class="w-full form-input" placeholder="e.g., 3.00">
                                <p id="target-cgpa-mid-error" class="text-red-500 text-sm error-placeholder"></p>
                            </div>
                            <div>
                                <label for="target-credits-mid" class="block text-sm font-medium text-tertiary-color mb-1">Next Trimester Credits</label>
                                <input type="number" id="target-credits-mid" min="0" step="0.5" class="w-full form-input" placeholder="e.g., 12">
                                <p id="target-credits-mid-error" class="text-red-500 text-sm error-placeholder"></p>
                            </div>
                        </div>
                        <div id="target-result-mid" class="mt-4 text-center hidden">
                            <p class="text-tertiary-color">You'll need a GPA of:</p>
                            <p id="required-gpa-mid" class="text-3xl font-bold text-orange-600"></p>
                        </div>
                    </div>
                </div>
                
                <div id="result-low" class="result-card w-full">
                     <div class="result-low border rounded-xl p-6 text-center">
                        <h3 id="low-cgpa-title" class="text-2xl font-bold text-red-800 mb-4">Probation!</h3>
                        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:divide-x-2 divide-red-200/50">
                            <div class="flex-1 px-4">
                                <p class="text-red-600 text-lg">New CGPA</p>
                                <p id="cgpa-low" class="text-4xl sm:text-5xl md:text-6xl font-bold text-red-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">Total Attempted Credit: <span id="total-credits-low">0</span></p>
                                <p class="text-sm text-secondary-color">Total Completed Credit: <span id="total-earned-credits-low">0</span></p>
                            </div>
                            <div class="flex-1 px-4 pt-4 md:pt-0 border-t-2 md:border-t-0 border-red-200/50">
                                <p class="text-red-600 text-lg">Trimester GPA</p>
                                <p id="tgpa-low" class="text-4xl sm:text-5xl md:text-6xl font-bold text-red-700 my-2">0.00</p>
                                <p class="text-sm text-secondary-color">Attempted Credit: <span id="trimester-credits-low">0</span></p>
                                <p class="text-sm text-secondary-color">Completed Credit: <span id="trimester-earned-credits-low">0</span></p>
                            </div>
                       </div>
                    </div>
                    <div class="mt-6 w-full planner-low p-4 rounded-lg border">
                        <h4 class="text-lg font-semibold text-primary-color text-center">Recovery Plan</h4>
                        <p class="text-center text-secondary-color mb-4">Let's find out what you need in your next trimester to reach a 2.0 CGPA.</p>
                        <div class="max-w-xs mx-auto">
                            <label for="next-credits" class="block text-sm font-medium text-tertiary-color mb-1">Next trimester's credits:</label>
                            <input type="number" id="next-credits" min="0" step="0.5" class="w-full form-input" placeholder="e.g., 9">
                            <p id="next-credits-error" class="text-red-500 text-sm error-placeholder"></p>
                        </div>

                        <div id="recovery-result" class="mt-4 text-center hidden">
                            <p class="text-tertiary-color">To get out of probation, you need a GPA of:</p>
                            <p id="required-gpa" class="text-3xl font-bold text-red-600"></p>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <div id="course-grade-tab" style="display: none;">
                <div class="form-section">
                    <h2 class="text-xl font-bold text-primary-color mb-4">Course Grade Calculator</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                        <div>
                            <label for="assignment-marks" class="block text-sm font-medium text-tertiary-color mb-2">Assignment (out of 5)</label>
                            <input type="number" id="assignment-marks" step="0.1" min="0" max="5" class="w-full form-input" placeholder="e.g., 4.5">
                        </div>
                        <div>
                            <label for="attendance-marks" class="block text-sm font-medium text-tertiary-color mb-2">Attendance (out of 5)</label>
                            <input type="number" id="attendance-marks" step="0.1" min="0" max="5" class="w-full form-input" placeholder="e.g., 5">
                        </div>
                        <div>
                            <label for="midterm-marks" class="block text-sm font-medium text-tertiary-color mb-2">Midterm (out of 30)</label>
                            <input type="number" id="midterm-marks" step="0.1" min="0" max="30" class="w-full form-input" placeholder="e.g., 25">
                        </div>
                        <div>
                            <label for="final-marks" class="block text-sm font-medium text-tertiary-color mb-2">Final (out of 40)</label>
                            <input type="number" id="final-marks" step="0.1" min="0" max="40" class="w-full form-input" placeholder="e.g., 32">
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <h2 class="text-xl font-bold text-primary-color mb-4">CT Marks</h2>
                    <div id="ct-scores-container" class="space-y-2"></div>
                    <button id="add-ct-score-btn" class="w-full btn btn-neutral mt-4"><i data-lucide="plus" class="w-5 h-5"></i>Add CT Score</button>
                    <div id="target-ct-result" class="mt-4 text-center hidden">
                        <p id="required-ct-marks" class="text-3xl font-bold text-indigo-600"></p>
                    </div>
                </div>
                <button id="calculate-course-grade" class="w-full btn btn-main-calc"><i data-lucide="bar-chart-2" class="w-6 h-6"></i>Calculate Grade</button>
                <div id="course-grade-result-section" class="mt-8 text-center" style="display: none;">
                    <p class="text-lg text-secondary-color">Your Grade:</p>
                    <p id="course-grade-display" class="text-5xl font-bold text-primary-color"></p>
                    <p id="course-points-display" class="text-2xl text-tertiary-color"></p>
                    <p id="course-marks-display" class="text-lg text-secondary-color"></p>
                    <p class="text-sm text-red-500 mt-2">Without Grace Mark</p>
                </div>
            </div>
            <div id="grading-policy-tab" style="display: none;">
                <div class="form-section">
                    <h2 class="text-xl font-bold text-primary-color mb-4 text-center">UIU Grading Policy</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-800">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Letter Grade</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Grade Points</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Marks Range (%)</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">A</td><td class="px-6 py-4 whitespace-nowrap">4.00</td><td class="px-6 py-4 whitespace-nowrap">90 – 100</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">A-</td><td class="px-6 py-4 whitespace-nowrap">3.67</td><td class="px-6 py-4 whitespace-nowrap">86 – 89</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">B+</td><td class="px-6 py-4 whitespace-nowrap">3.33</td><td class="px-6 py-4 whitespace-nowrap">82 – 85</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">B</td><td class="px-6 py-4 whitespace-nowrap">3.00</td><td class="px-6 py-4 whitespace-nowrap">78 – 81</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">B-</td><td class="px-6 py-4 whitespace-nowrap">2.67</td><td class="px-6 py-4 whitespace-nowrap">74 – 77</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">C+</td><td class="px-6 py-4 whitespace-nowrap">2.33</td><td class="px-6 py-4 whitespace-nowrap">70 – 73</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">C</td><td class="px-6 py-4 whitespace-nowrap">2.00</td><td class="px-6 py-4 whitespace-nowrap">66 – 69</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">C-</td><td class="px-6 py-4 whitespace-nowrap">1.67</td><td class="px-6 py-4 whitespace-nowrap">62 – 65</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">D+</td><td class="px-6 py-4 whitespace-nowrap">1.33</td><td class="px-6 py-4 whitespace-nowrap">58 – 61</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">D</td><td class="px-6 py-4 whitespace-nowrap">1.00</td><td class="px-6 py-4 whitespace-nowrap">55 – 57</td></tr>
                                <tr class="dark:bg-gray-800 dark:text-gray-200"><td class="px-6 py-4 whitespace-nowrap">F</td><td class="px-6 py-4 whitespace-nowrap">0.00</td><td class="px-6 py-4 whitespace-nowrap">0 – 54</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <footer class="text-center mt-8 text-sm text-secondary-color font-semibold">
            <p>Developed by <a href="https://www.facebook.com/naiimurr" target="_blank" rel="noopener noreferrer" class="text-indigo-400 hover:underline">Naimur Rahman</a> (CSE 242) for the students of UIU❤️</p>
        </footer>
    </main>

    <button id="open-game-modal" class="btn">
        <i data-lucide="gamepad-2" class="w-7 h-7"></i>
    </button>

    <div id="game-modal" class="fade-in">
        <div id="game-modal-content" class="fade-in-up">
            <button id="close-game-modal">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            
            <h2 class="text-2xl font-bold text-primary-color mb-4 text-center">Relax Zone</h2>

            <div class="form-section !p-3">
                 <div id="game-selection" class="flex flex-col sm:flex-row gap-2 flex-wrap justify-center">
                     <button id="select-game-ttt" data-game="tic-tac-toe" class="game-select-btn btn btn-primary flex-1 min-w-[150px]"><i data-lucide="grid-3x3" class="w-5 h-5"></i>Tic-Tac-Toe</button>
                     <button id="select-game-memory" data-game="memory-match" class="game-select-btn btn btn-neutral flex-1 min-w-[150px]"><i data-lucide="brain" class="w-5 h-5"></i>Memory Match</button>
                     <button id="select-game-snake" data-game="snake" class="game-select-btn btn btn-neutral flex-1 min-w-[150px]"><i data-lucide="rat" class="w-5 h-5"></i>Snake</button>
                     <button id="select-game-wam" data-game="whac-a-mole" class="game-select-btn btn btn-neutral flex-1 min-w-[150px]"><i data-lucide="hammer" class="w-5 h-5"></i>Whac-A-Mole</button>
                     <button id="select-game-word-guess" data-game="word-guess" class="game-select-btn btn btn-neutral flex-1 min-w-[150px]"><i data-lucide="spell-check" class="w-5 h-5"></i>Word Guess</button>
                      <button id="select-game-breakout" data-game="breakout" class="game-select-btn btn btn-neutral flex-1 min-w-[150px]"><i data-lucide="tablets" class="w-5 h-5"></i>Breakout</button>
                 </div>
            </div>

            <div id="game-tic-tac-toe" class="game-container">
                <div class="form-section !mb-0 text-center">
                    <h3 class="text-xl font-bold text-primary-color mb-4 text-center">Tic-Tac-Toe</h3>
                    <div id="ttt-status" class="game-status text-center mb-4">Your Turn (X)</div>
                    <div id="tic-tac-toe-board">
                        <div class="ttt-cell" data-index="0"><span>X</span></div>
                        <div class="ttt-cell" data-index="1"><span>X</span></div>
                        <div class="ttt-cell" data-index="2"><span>X</span></div>
                        <div class="ttt-cell" data-index="3"><span>X</span></div>
                        <div class="ttt-cell" data-index="4"><span>X</span></div>
                        <div class="ttt-cell" data-index="5"><span>X</span></div>
                        <div class="ttt-cell" data-index="6"><span>X</span></div>
                        <div class="ttt-cell" data-index="7"><span>X</span></div>
                        <div class="ttt-cell" data-index="8"><span>X</span></div>
                    </div>
                    <button id="ttt-reset-btn" class="w-full sm:w-auto mx-auto btn btn-primary mt-6 flex">
                        <i data-lucide="rotate-ccw" class="w-5 h-5"></i>Reset Game
                    </button>
                </div>
            </div>

            <div id="game-memory-match" class="game-container">
                <div class="form-section !mb-0 text-center">
                    <h3 class="text-xl font-bold text-primary-color mb-4 text-center">Memory Match</h3>
                    <div id="memory-difficulty-select">
                        <button class="btn btn-sm btn-primary" data-difficulty="easy">Easy (4x3)</button>
                        <button class="btn btn-sm btn-neutral" data-difficulty="medium">Medium (4x4)</button>
                        <button class="btn btn-sm btn-neutral" data-difficulty="hard">Hard (5x4)</button>
                    </div>
                    <div id="memory-status" class="game-status text-center mb-4">Moves: 0</div>
                    <div id="memory-board"></div>
                    <button id="memory-reset-btn" class="w-full sm:w-auto mx-auto btn btn-primary mt-6 flex">
                        <i data-lucide="rotate-ccw" class="w-5 h-5"></i>Reset Game
                    </button>
                </div>
            </div>

            <div id="game-snake" class="game-container">
                <div class="form-section !mb-0 text-center">
                    <h3 class="text-xl font-bold text-primary-color mb-4 text-center">Snake</h3>
                    <div id="game-status-snake" class="game-status text-center mb-4">Score: 0</div>
                    <div id="snake-game-container">
                        <canvas id="snake-canvas" width="400" height="400"></canvas>
                        <div id="snake-controls">
                            <button id="snake-up" class="snake-control-btn"><i data-lucide="arrow-up"></i></button>
                            <button id="snake-left" class="snake-control-btn"><i data-lucide="arrow-left"></i></button>
                            <button id="snake-down" class="snake-control-btn"><i data-lucide="arrow-down"></i></button>
                            <button id="snake-right" class="snake-control-btn"><i data-lucide="arrow-right"></i></button>
                        </div>
                    </div>
                    <button id="snake-reset-btn" class="w-full sm:w-auto mx-auto btn btn-primary mt-6 flex">
                        <i data-lucide="rotate-ccw" class="w-5 h-5"></i>Reset Game
                    </button>
                </div>
            </div>

            <div id="game-whac-a-mole" class="game-container">
                <div class="form-section !mb-0 text-center">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-primary-color text-left">Whac-A-Mole</h3>
                        <div class="text-right">
                            <span class="block text-sm text-tertiary-color">SCORE</span>
                            <span id="game-status-wam" class="text-2xl font-bold text-primary-color">0</span>
                        </div>
                    </div>
                    <div id="game-status-timer-wam" class="game-status text-center mb-4">Time: 30s</div>
                    <div id="wam-board"></div>
                    <button id="wam-start-btn" class="w-full sm:w-auto mx-auto btn btn-primary mt-6 flex">
                        <i data-lucide="play" class="w-5 h-5"></i>Start Game
                    </button>
                </div>
            </div>

            <div id="game-word-guess" class="game-container">
                <div class="form-section !mb-0 text-center">
                    <h3 class="text-xl font-bold text-primary-color mb-4 text-center">Word Guess</h3>
                    <div id="wg-status" class="game-status text-center mb-4">Guesses left: 6</div>
                    <div id="wg-word-display"></div>
                    <div id="wg-guessed-letters" class="text-center text-secondary-color">Guessed: </div>
                    <form id="wg-input-area">
                        <input type="text" id="wg-letter-input" class="form-input" maxlength="1" placeholder="A" />
                        <button type="submit" class="btn btn-primary">Guess</button>
                    </form>
                    <button id="wg-reset-btn" class="w-full sm:w-auto mx-auto btn btn-primary mt-6 flex">
                        <i data-lucide="rotate-ccw" class="w-5 h-5"></i>New Word
                    </button>
                </div>
            </div>

            <div id="game-breakout" class="game-container">
                <div class="form-section !mb-0 text-center">
                    <h3 class="text-xl font-bold text-primary-color mb-4 text-center">Breakout</h3>
                    <div id="breakout-status" class="game-status text-center mb-4">
                        <span id="breakout-score">Score: 0</span>
                        <span id="breakout-lives">Lives: 3</span>
                    </div>
                    <div id="breakout-game-container">
                        <canvas id="breakout-canvas" width="480" height="400"></canvas>
                        <div id="breakout-controls">
                            <button id="breakout-left" class="breakout-control-btn"><i data-lucide="arrow-left"></i></button>
                            <button id="breakout-right" class="breakout-control-btn"><i data-lucide="arrow-right"></i></button>
                        </div>
                    </div>
                    <button id="breakout-reset-btn" class="w-full sm:w-auto mx-auto btn btn-primary mt-6 flex">
                        <i data-lucide="rotate-ccw" class="w-5 h-5"></i>Reset Game
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Course Grade Calculator Elements --- //
            const addCtScoreBtn = document.getElementById('add-ct-score-btn');
            const ctScoresContainer = document.getElementById('ct-scores-container');
            const calculateCourseGradeBtn = document.getElementById('calculate-course-grade');
            const targetCtResultEl = document.getElementById('target-ct-result');
            const requiredCtMarksEl = document.getElementById('required-ct-marks');
            const courseGradeResultSection = document.getElementById('course-grade-result-section');
            const courseGradeDisplay = document.getElementById('course-grade-display');
            const coursePointsDisplay = document.getElementById('course-points-display');
            const courseMarksDisplay = document.getElementById('course-marks-display');

            let ctScores = [];

            // --- Course Grade: Input clamping helpers (prevent values over max) --- //
            const clamp = (value, min, max) => {
                const n = typeof value === 'number' ? value : parseFloat(value);
                if (isNaN(n)) return min;
                return Math.min(Math.max(n, min), max);
            };

            const assignmentInput = document.getElementById('assignment-marks');
            const attendanceInput = document.getElementById('attendance-marks');
            const midtermInput = document.getElementById('midterm-marks');
            const finalInput = document.getElementById('final-marks');

            const setClampListener = (el, min, max) => {
                if (!el) return;
                el.addEventListener('input', () => {
                    const val = parseFloat(el.value);
                    if (isNaN(val)) return;
                    const clamped = clamp(val, min, max);
                    if (clamped !== val) el.value = clamped;
                });
            };

            // Clamp as user types
            setClampListener(assignmentInput, 0, 5);
            setClampListener(attendanceInput, 0, 5);
            setClampListener(midtermInput, 0, 30);
            setClampListener(finalInput, 0, 40);

            const calculateTargetCt = () => {
                const enteredScores = Array.from(ctScoresContainer.querySelectorAll('input')).map(input => {
                    const val = parseFloat(input.value);
                    if (isNaN(val)) return null;
                    const clampedVal = clamp(val, 0, 20);
                    if (clampedVal !== val) input.value = clampedVal;
                    return clampedVal;
                });
                const validScores = enteredScores.filter(s => s !== null);

                if (validScores.length < 3) {
                    targetCtResultEl.classList.add('hidden');
                    return;
                }

                const sortedScores = [...validScores].sort((a, b) => b - a);
                const bestThree = sortedScores.slice(0, 3);
                const currentCtMarks = bestThree.reduce((a, b) => a + b, 0) / 3;
                const currentCtAvg = Math.min(20, currentCtMarks);

                targetCtResultEl.classList.remove('hidden');
                if (validScores.length === 3) {
                     requiredCtMarksEl.textContent = `Current Best 3 Avg: ${currentCtAvg.toFixed(2)} / 20`;
                } else if (validScores.length === 4) {
                     requiredCtMarksEl.textContent = `Final CT Mark (Best 3): ${currentCtAvg.toFixed(2)} / 20`;
                }
            };

            addCtScoreBtn.addEventListener('click', () => {
                const ctInputs = ctScoresContainer.getElementsByTagName('input');
                if (ctInputs.length >= 4) {
                    showNotification("You can add a maximum of 4 CT scores.", 'error');
                    return;
                }
                const newIndex = ctInputs.length;
                const ctInputContainer = document.createElement('div');
                ctInputContainer.className = 'flex items-center gap-2';
                ctInputContainer.innerHTML = `
                    <label for="ct-score-${newIndex}" class="block text-sm font-medium text-tertiary-color">CT ${newIndex + 1} (20)</label>
                    <input type="number" id="ct-score-${newIndex}" step="0.1" min="0" max="20" class="w-full form-input ct-score-input" placeholder="e.g., 18">
                     <button class="remove-ct-btn text-red-400 hover:text-red-600 p-2 rounded-full transition-colors"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                `;
                ctScoresContainer.appendChild(ctInputContainer);
                if (lucide && typeof lucide.createIcons === 'function') {
                    lucide.createIcons();
                }

                const ctInputEl = ctInputContainer.querySelector('.ct-score-input');
                ctInputEl.addEventListener('input', () => {
                    const val = parseFloat(ctInputEl.value);
                    if (!isNaN(val)) {
                        const clamped = clamp(val, 0, 20);
                        if (clamped !== val) ctInputEl.value = clamped;
                    }
                    calculateTargetCt();
                });
                 ctInputContainer.querySelector('.remove-ct-btn').addEventListener('click', () => {
                    ctInputContainer.remove();
                    // Re-label inputs
                    const remainingInputs = ctScoresContainer.querySelectorAll('.flex');
                    remainingInputs.forEach((container, index) => {
                        container.querySelector('label').textContent = `CT ${index + 1} (20)`;
                        container.querySelector('label').setAttribute('for', `ct-score-${index}`);
                        container.querySelector('input').setAttribute('id', `ct-score-${index}`);
                    });
                    calculateTargetCt();
                });
                calculateTargetCt();
            });

            calculateCourseGradeBtn.addEventListener('click', () => {
                // Clamp all inputs to their valid ranges before calculating
                const assignmentEl = document.getElementById('assignment-marks');
                const attendanceEl = document.getElementById('attendance-marks');
                const midtermEl = document.getElementById('midterm-marks');
                const finalEl = document.getElementById('final-marks');

                const assignment = clamp(parseFloat(assignmentEl.value) || 0, 0, 5); assignmentEl.value = assignment;
                const attendance = clamp(parseFloat(attendanceEl.value) || 0, 0, 5); attendanceEl.value = attendance;
                const midterm = clamp(parseFloat(midtermEl.value) || 0, 0, 30); midtermEl.value = midterm;
                const final = clamp(parseFloat(finalEl.value) || 0, 0, 40); finalEl.value = final;

                const ctInputs = Array.from(ctScoresContainer.querySelectorAll('.ct-score-input'));
                const ctScores = ctInputs.map(input => {
                    const raw = parseFloat(input.value) || 0;
                    const clamped = clamp(raw, 0, 20);
                    if (input.value !== '' && raw !== clamped) input.value = clamped;
                    return clamped;
                });

                if (ctScores.length < 3) {
                    showNotification("Please enter at least 3 CT scores.", "error");
                    return;
                }

                const sortedScores = [...ctScores].sort((a, b) => b - a);
                const bestThreeScores = sortedScores.slice(0, 3);
                const avgCtScore = bestThreeScores.reduce((a, b) => a + b, 0) / 3; // already <= 20

                const rawTotal = assignment + attendance + midterm + final + avgCtScore;
                const totalMarks = Math.min(100, rawTotal);

                let grade = '', points = 0.00;
                if (totalMarks >= 90) { grade = 'A'; points = 4.00; }
                else if (totalMarks >= 86) { grade = 'A-'; points = 3.67; }
                else if (totalMarks >= 82) { grade = 'B+'; points = 3.33; }
                else if (totalMarks >= 78) { grade = 'B'; points = 3.00; }
                else if (totalMarks >= 74) { grade = 'B-'; points = 2.67; }
                else if (totalMarks >= 70) { grade = 'C+'; points = 2.33; }
                else if (totalMarks >= 66) { grade = 'C'; points = 2.00; }
                else if (totalMarks >= 62) { grade = 'C-'; points = 1.67; }
                else if (totalMarks >= 58) { grade = 'D+'; points = 1.33; }
                else if (totalMarks >= 55) { grade = 'D'; points = 1.00; }
                else { grade = 'F'; points = 0.00; }

                courseGradeDisplay.textContent = grade;
                coursePointsDisplay.textContent = `(${points.toFixed(2)} Points)`;
                courseMarksDisplay.textContent = `Total Marks: ${totalMarks.toFixed(2)} / 100`;
                courseGradeResultSection.style.display = 'block';
            });

            // --- Tab Switching Logic --- //
            const cgpaTabBtn = document.getElementById('cgpa-tab-btn');
            const courseGradeTabBtn = document.getElementById('course-grade-tab-btn');
            const gradingPolicyTabBtn = document.getElementById('grading-policy-tab-btn');

            const cgpaCalculatorTab = document.getElementById('cgpa-calculator-tab');
            const courseGradeTab = document.getElementById('course-grade-tab');
            const gradingPolicyTab = document.getElementById('grading-policy-tab');

            const allTabs = [cgpaCalculatorTab, courseGradeTab, gradingPolicyTab];
            const allTabBtns = [cgpaTabBtn, courseGradeTabBtn, gradingPolicyTabBtn];

            const switchTab = (tabToShow, btnToActivate) => {
                allTabs.forEach(tab => tab.style.display = 'none');
                allTabBtns.forEach(btn => {
                    btn.classList.remove('text-indigo-600', 'dark:text-indigo-400', 'border-indigo-500');
                    btn.classList.add('text-gray-500', 'dark:text-gray-400', 'border-transparent');
                });

                tabToShow.style.display = 'block';
                btnToActivate.classList.add('text-indigo-600', 'dark:text-indigo-400', 'border-indigo-500');
                btnToActivate.classList.remove('text-gray-500', 'dark:text-gray-400', 'border-transparent');
            };

            cgpaTabBtn.addEventListener('click', () => switchTab(cgpaCalculatorTab, cgpaTabBtn));
            courseGradeTabBtn.addEventListener('click', () => switchTab(courseGradeTab, courseGradeTabBtn));
            gradingPolicyTabBtn.addEventListener('click', () => switchTab(gradingPolicyTab, gradingPolicyTabBtn));

            // --- Elements (Combined) --- //
            const getEl = (id) => document.getElementById(id);
            const body = document.body;
            const themeToggle = getEl('theme-toggle-checkbox');
            const themeIcon = getEl('theme-icon');

            // Calculator Elements
            const currentCgpaInput = getEl('current-cgpa');
            const completedCreditsInput = getEl('completed-credits');
            const completedEarnedCreditsInput = getEl('completed-earned-credits');
            const addCourseForm = getEl('add-course-form');
            const courseCreditEl = getEl('course-credit');
            const courseGradeEl = getEl('course-grade');
            const addRetakeForm = getEl('add-retake-form');
            const retakeCreditEl = getEl('retake-credit');
            const retakeOldGradeEl = getEl('retake-old-grade');
            const retakeNewGradeEl = getEl('retake-new-grade');
            const courseListContainer = getEl('course-list-container');
            const calculateBtn = getEl('calculate-cgpa');
            const resetBtn = getEl('reset-all');
            const cgpaErrorEl = getEl('cgpa-error');
            const attemptedCreditsErrorEl = getEl('attempted-credits-error');
            const earnedCreditsErrorEl = getEl('earned-credits-error');
            const calcErrorEl = getEl('calc-error');
            const creditsErrorEl = getEl('credits-error');
            const errorPlaceholders = document.querySelectorAll('.error-placeholder');
            const resultCards = { good: getEl('result-good'), mid: getEl('result-mid'), low: getEl('result-low') };
            const allResultCards = document.querySelectorAll('.result-card');

            // Game Elements
            const gameModal = getEl('game-modal');
            const openGameModalBtn = getEl('open-game-modal');
            const closeGameModalBtn = getEl('close-game-modal');
            const gameSelection = getEl('game-selection');
            const gameSelectBtns = document.querySelectorAll('.game-select-btn');
            const gameContainers = document.querySelectorAll('.game-container');
            
            // --- State (Calculator) --- //
            let courses = [];
            let calculationCache = { finalCgpa: 0, totalGpaCredits: 0, currentTotalPoints: 0, totalCompletedCredits: 0 };
            
            // --- Shared Helper Functions --- //
            const showNotification = (message, type = 'success') => {
                const container = getEl('notification-container');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                let icon;
                switch(type) {
                    case 'error': icon = 'alert-circle'; break;
                    case 'info': icon = 'info'; break;
                    case 'warning': icon = 'alert-triangle'; break;
                    default: icon = 'check-circle';
                }
                notification.innerHTML = `<i data-lucide="${icon}" class="w-5 h-5"></i><span>${message}</span>`;
                container.appendChild(notification);
                if (lucide && typeof lucide.createIcons === 'function') {
                    lucide.createIcons();
                }
                setTimeout(() => notification.classList.add('show'), 10);
                setTimeout(() => {
                    notification.classList.remove('show');
                    notification.addEventListener('transitionend', () => notification.remove());
                }, 3000);
            };

            const shuffle = (array) => array.sort(() => Math.random() - 0.5);

            // --- Theme Management --- //
            const updateTheme = (isDark) => {
                body.setAttribute('data-theme', isDark ? 'dark' : 'light');
                if (themeToggle) themeToggle.checked = isDark;
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                const iconHtml = isDark ?
                    '<i data-lucide="moon" class="w-5 h-5 text-blue-300"></i>' :
                    '<i data-lucide="sun" class="w-5 h-5 text-yellow-500"></i>';
                if (themeIcon) themeIcon.innerHTML = iconHtml;
                if (lucide && typeof lucide.createIcons === 'function') {
                    lucide.createIcons();
                }
            };

            const initializeTheme = () => {
                const savedTheme = localStorage.getItem('theme');
                updateTheme(savedTheme === 'dark');
            };

            // --- Calculator-Specific Functions --- //
            const saveState = () => {
                const state = {
                    courses,
                    currentCgpa: currentCgpaInput.value,
                    completedCredits: completedCreditsInput.value,
                    completedEarnedCredits: completedEarnedCreditsInput.value
                };
                localStorage.setItem('cgpaCalculatorState', JSON.stringify(state));
            };

            const loadState = () => {
                const savedState = localStorage.getItem('cgpaCalculatorState');
                if (savedState) {
                    const { courses: savedCourses, currentCgpa, completedCredits, completedEarnedCredits } = JSON.parse(savedState);
                    courses = savedCourses || [];
                    currentCgpaInput.value = currentCgpa || '';
                    completedCreditsInput.value = completedCredits || '';
                    completedEarnedCreditsInput.value = completedEarnedCredits || '';
                    renderCourses();
                }
            };

            const animateValue = (el, endValue, isFloat = true) => {
                let startValue = 0;
                const duration = 1000;
                const startTime = performance.now();
                function step(currentTime) {
                    const elapsedTime = currentTime - startTime;
                    const progress = Math.min(elapsedTime / duration, 1);
                    const easeOutQuad = 1 - Math.pow(1 - progress, 3);
                    let currentValue = startValue + (endValue - startValue) * easeOutQuad;
                    if (isNaN(currentValue) || !isFinite(currentValue)) { currentValue = endValue; }
                    if (progress < 1) {
                        el.textContent = isFloat ? currentValue.toFixed(2) : Math.round(currentValue);
                        requestAnimationFrame(step);
                    } else {
                        el.textContent = isFloat ? endValue.toFixed(2) : (endValue % 1 === 0 ? endValue.toFixed(0) : endValue.toFixed(2));
                    }
                }
                const existingText = el.textContent.trim();
                if (existingText && !isNaN(parseFloat(existingText))) { startValue = parseFloat(existingText); }
                requestAnimationFrame(step);
            };

            const triggerConfetti = () => {
                const parent = document.querySelector('.card');
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-piece';
                    const colors = ['#4f46e5', '#10b981', '#f59e0b', '#ef4444', '#6366f1'];
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.animation = `fall ${1.5 + Math.random() * 2}s ${Math.random() * 1}s linear forwards`;
                    parent.appendChild(confetti);
                }
                const keyframes = `@keyframes fall { to { transform: translateY(100vh) rotate(${Math.random() * 720}deg); opacity: 0; } }`;
                const styleSheet = document.createElement("style");
                styleSheet.type = "text/css";
                styleSheet.innerText = keyframes;
                document.head.appendChild(styleSheet);
                setTimeout(() => {
                    document.querySelectorAll('.confetti-piece').forEach(e => e.remove());
                    if (styleSheet.parentNode) { styleSheet.parentNode.removeChild(styleSheet); }
                }, 4000);
            };

            const gradeMap = {
                "4.00": "A", "3.67": "A-", "3.33": "B+", "3.00": "B", "2.67": "B-",
                "2.33": "C+", "2.00": "C", "1.67": "C-", "1.33": "D+", "1.00": "D", "0.00": "F"
            };

            const getGradeLetter = (grade) => {
                const gradeNum = typeof grade === 'number' ? grade : parseFloat(grade);
                if (isNaN(gradeNum)) return '';
                return gradeMap[gradeNum.toFixed(2)] || '';
            };

            const renderCourses = () => {
                courseListContainer.innerHTML = '';
                if (courses.length === 0) {
                    courseListContainer.innerHTML = `<div class="text-center text-secondary-color p-4 course-list-placeholder-bg rounded-lg fade-in"><p>No courses added yet.</p></div>`;
                    return;
                }
                courses.forEach((course, index) => {
                    const courseEl = document.createElement('div');
                    courseEl.style.setProperty('--stagger-delay', `${index * 100}ms`);
                    let courseHTML = '';
                    let courseClass = 'course-item-container fade-in-up';
                    const gradeValueRaw = course.type === 'new' ? course.grade : course.newGrade;
                    const gradeValueNum = typeof gradeValueRaw === 'number' ? gradeValueRaw : parseFloat(gradeValueRaw);
                    const gradeValue = isNaN(gradeValueNum) ? 'N/A' : gradeValueNum.toFixed(2);
                    const gradeLetter = getGradeLetter(gradeValueNum);
                    if (course.type === 'new') {
                        courseClass += ' new-course';
                        courseHTML = `<div class="flex-grow"><p class="font-semibold text-tertiary-color">${course.credit} Credits</p></div><div class="text-center"><span class="font-bold text-lg text-blue-500">${gradeLetter}</span><span class="block text-xs text-secondary-color">(${gradeValue})</span></div>`;
                    } else { // Retake
                        courseClass += ' retake-course';
                        const oldGradeLetter = getGradeLetter(course.oldGrade);
                        const newGradeLetter = getGradeLetter(course.newGrade);
                        const newGradeNum = typeof course.newGrade === 'number' ? course.newGrade : parseFloat(course.newGrade);
                        const newGradeValue = isNaN(newGradeNum) ? 'N/A' : newGradeNum.toFixed(2);
                        courseHTML = `<div class="flex-grow"><p class="font-semibold text-tertiary-color">${course.credit} Credits <span class="font-bold text-purple-500">(Retake)</span></p></div><div class="text-center flex items-center gap-1"><span class="font-bold text-secondary-color line-through text-sm">${oldGradeLetter}</span><i data-lucide="arrow-right" class="w-4 h-4 text-secondary-color"></i><div><span class="font-bold text-lg text-green-500">${newGradeLetter}</span><span class="block text-xs text-secondary-color">(${newGradeValue})</span></div></div>`;
                    }
                    courseEl.className = courseClass;
                    courseEl.innerHTML = courseHTML + `<button class="remove-btn text-red-400 hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-900/50 p-2 rounded-full transition-colors" data-index="${index}"><i data-lucide="trash-2" class="w-5 h-5"></i></button>`;
                    courseListContainer.appendChild(courseEl);
                });
                if (lucide && typeof lucide.createIcons === 'function') {
                    lucide.createIcons();
                }
            };

            const hideResults = () => {
                allResultCards.forEach(card => { card.style.display = 'none'; card.classList.remove('fade-in-up'); });
                errorPlaceholders.forEach(el => { el.textContent = ''; el.classList.remove('visible'); });
                calcErrorEl.textContent = ''; creditsErrorEl.textContent = '';
                calcErrorEl.classList.add('hidden'); creditsErrorEl.classList.add('hidden');
            };

            const handleCalculation = () => {
                hideResults();
                let hasError = false;
                const currentCgpaVal = currentCgpaInput.value.trim();
                const currentCgpa = parseFloat(currentCgpaVal);
                if (currentCgpaVal && (isNaN(currentCgpa) || currentCgpa > 4.0 || currentCgpa < 0)) {
                    cgpaErrorEl.textContent = "Aeh! 🙂"; cgpaErrorEl.classList.add('visible'); hasError = true;
                }
                const initialAttemptedCreditsVal = completedCreditsInput.value.trim();
                const initialEarnedCreditsVal = completedEarnedCreditsInput.value.trim();
                const initialAttemptedCredits = parseFloat(initialAttemptedCreditsVal);
                const initialEarnedCredits = parseFloat(initialEarnedCreditsVal);
                const hasInitialStandingAttempt = currentCgpaVal !== '' || initialAttemptedCreditsVal !== '' || initialEarnedCreditsVal !== '';
                const isInitialStandingComplete = currentCgpaVal !== '' && !isNaN(currentCgpa) && currentCgpa >= 0 && currentCgpa <= 4.0 && initialAttemptedCreditsVal !== '' && !isNaN(initialAttemptedCredits) && initialAttemptedCredits >= 0 && initialEarnedCreditsVal !== '' && !isNaN(initialEarnedCredits) && initialEarnedCredits >= 0;
                
                if (hasInitialStandingAttempt && !isInitialStandingComplete) {
                    if (currentCgpaVal === '') { cgpaErrorEl.textContent = "Required."; cgpaErrorEl.classList.add('visible'); hasError = true; }
                    else if (isNaN(currentCgpa) || currentCgpa < 0 || currentCgpa > 4.0) { cgpaErrorEl.textContent = "Aeh! 🙂"; cgpaErrorEl.classList.add('visible'); hasError = true; }
                    if (initialAttemptedCreditsVal === '' || isNaN(initialAttemptedCredits) || initialAttemptedCredits < 0) { if(attemptedCreditsErrorEl){ attemptedCreditsErrorEl.textContent = "Required & >= 0."; attemptedCreditsErrorEl.classList.add('visible');} hasError = true; }
                    if (initialEarnedCreditsVal === '' || isNaN(initialEarnedCredits) || initialEarnedCredits < 0) { if(earnedCreditsErrorEl){ earnedCreditsErrorEl.textContent = "Required & >= 0."; earnedCreditsErrorEl.classList.add('visible');} hasError = true; }
                } else if (isInitialStandingComplete && initialEarnedCredits > initialAttemptedCredits) {
                    creditsErrorEl.textContent = "Earned credits cannot be greater than attempted credits.";
                    creditsErrorEl.classList.remove('hidden');
                    hasError = true;
                }
                
                if (courses.length === 0) { if (!hasError) { calcErrorEl.textContent = "Please add at least one course."; calcErrorEl.classList.remove('hidden'); } hasError = true; }
                const trimesterCredits = courses.reduce((total, course) => total + course.credit, 0);

                // --- MODIFIED CODE BLOCK ---
                // This block now shows a warning instead of stopping the calculation.
                if (!hasError && courses.length > 0 && trimesterCredits < 6) {
                    showNotification("Note: Trimester has less than 6 credits.", 'warning');
                    // We no longer set hasError = true, which allows the calculation to proceed.
                }
                // --- END OF MODIFICATION ---

                const hasRetakes = courses.some(c => c.type === 'retake');
                if (!hasError && hasRetakes && !isInitialStandingComplete) {
                    calcErrorEl.textContent = hasInitialStandingAttempt ? "Enter complete & valid Current Standing for retakes." : "Enter Current Standing to add retake courses.";
                    calcErrorEl.classList.remove('hidden'); hasError = true;
                }
                if(hasError) return;
                const results = calculateResults();
                displayResults(results);
            };

            const calculateResults = () => {
                const currentCgpa = parseFloat(currentCgpaInput.value) || 0;
                const initialAttemptedCredits = parseFloat(completedCreditsInput.value) || 0;
                const initialEarnedCredits = parseFloat(completedEarnedCreditsInput.value) || 0;
                const hasInitialStanding = currentCgpaInput.value.trim() !== '' && !isNaN(parseFloat(currentCgpaInput.value)) && completedCreditsInput.value.trim() !== '' && !isNaN(initialAttemptedCredits) && initialAttemptedCredits >= 0 && completedEarnedCreditsInput.value.trim() !== '' && !isNaN(initialEarnedCredits) && initialEarnedCredits >= 0;
                const initialPoints = currentCgpa * initialAttemptedCredits;
                let totalPoints = initialPoints;
                let totalGpaCredits = initialAttemptedCredits;
                let totalCompletedCredits = initialEarnedCredits; 
                let trimesterPoints = 0, trimesterGpaCredits = 0, trimesterCompletedCredits = 0;
                courses.forEach(course => {
                    const credit = course.credit;
                    trimesterGpaCredits += credit;
                    if (course.type === 'new') {
                        const grade = course.grade;
                        trimesterPoints += credit * grade;
                        totalPoints += credit * grade; 
                        totalGpaCredits += credit;
                        if (grade > 0) { trimesterCompletedCredits += credit; totalCompletedCredits += credit; }
                    } else { // Retake
                        const oldGrade = course.oldGrade, newGrade = course.newGrade;
                        trimesterPoints += credit * newGrade;
                        
                        // This logic is for *trimester* completed credits, which only increments if retaking an F
                        if (oldGrade === 0 && newGrade > 0) { 
                            trimesterCompletedCredits += credit;
                        }

                        if (hasInitialStanding) {
                            totalPoints = totalPoints - (oldGrade * credit) + (newGrade * credit);
                            if (oldGrade === 0 && newGrade > 0) { totalCompletedCredits += credit; }
                            else if (oldGrade > 0 && newGrade === 0) { totalCompletedCredits -= credit; }
                        } 
                        // No 'else' here, because retakes without initial standing are blocked by handleCalculation
                    }
                });
                const finalCgpa = totalGpaCredits > 0 ? totalPoints / totalGpaCredits : 0;
                const trimesterGpa = trimesterGpaCredits > 0 ? trimesterPoints / trimesterGpaCredits : 0;
                totalCompletedCredits = Math.max(0, totalCompletedCredits);
                calculationCache = { finalCgpa, totalGpaCredits, currentTotalPoints: totalPoints, totalCompletedCredits };
                return { finalCgpa, trimesterGpa, totalGpaCredits, trimesterGpaCredits, trimesterCompletedCredits, totalCompletedCredits };
            };
            
            const displayResults = ({ finalCgpa, trimesterGpa, totalGpaCredits, trimesterGpaCredits, trimesterCompletedCredits, totalCompletedCredits }) => {
                let card, standing;
                if (finalCgpa >= 3.0) {
                    standing = 'good';
                    const titleEl = getEl('good-standing-title');
                    if (finalCgpa >= 3.8) titleEl.textContent = "তুখোড় ইশটুডেন্ট! 🎓";
                    else if (finalCgpa >= 3.5) titleEl.textContent = "ওয়েভারওয়ালা! 💸";
                    else if (finalCgpa >= 3.2) titleEl.textContent = "সেইফ জোনে আছেন 😌";
                    else titleEl.textContent = "সিজি ৩.০০ ধরে রাখেন! 😅";
                    if (finalCgpa >= 3.8 && trimesterGpa >= 3.8) triggerConfetti();
                } else if (finalCgpa >= 2.0) {
                    standing = 'mid';
                    const titleEl = getEl('mid-standing-title');
                    if (finalCgpa >= 2.6) titleEl.textContent = "কামব্যাক মাস্ট! 💪";
                    else if (finalCgpa >= 2.2) titleEl.textContent = "রেড জোনে আছেন! 🚨";
                    else titleEl.textContent = "আরেকটু হলেই লেটার ধরিয়ে দেবে! 📉";
                } else {
                    standing = 'low';
                    const titleEl = getEl('low-cgpa-title');
                    if(finalCgpa < 1.5) titleEl.textContent = "RIP 💀";
                    else titleEl.textContent = "জঘন্য রকমের পরিশ্রমী হন! 🤯";
                }
                card = resultCards[standing];
                animateValue(getEl(`cgpa-${standing}`), Math.min(finalCgpa, 4.00), true);
                animateValue(getEl(`tgpa-${standing}`), Math.min(trimesterGpa, 4.00), true);
                animateValue(getEl(`total-credits-${standing}`), totalGpaCredits, totalGpaCredits % 1 !== 0);
                animateValue(getEl(`trimester-credits-${standing}`), trimesterGpaCredits, trimesterGpaCredits % 1 !== 0);
                animateValue(getEl(`trimester-earned-credits-${standing}`), trimesterCompletedCredits, trimesterCompletedCredits % 1 !== 0);
                animateValue(getEl(`total-earned-credits-${standing}`), totalCompletedCredits, totalCompletedCredits % 1 !== 0);
                card.style.display = 'block';
                setTimeout(() => card.classList.add('fade-in-up'), 10);
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            };

            const handleTargetCalculation = (targetCgpaInput, targetCreditsInput, resultEl, gpaEl, errorEl) => {
                const targetCgpa = parseFloat(targetCgpaInput.value);
                const nextCredits = parseFloat(targetCreditsInput.value);
                const targetCgpaErrorEl = targetCgpaInput.nextElementSibling;
                errorEl.textContent = ''; errorEl.classList.remove('visible');
                if (targetCgpaErrorEl) { targetCgpaErrorEl.textContent = ''; targetCgpaErrorEl.classList.remove('visible'); }
                let creditsValid = true;
                if (isNaN(nextCredits) || nextCredits <= 0) { resultEl.classList.add('hidden'); if (targetCreditsInput.value.trim() !== '') { errorEl.textContent = 'Credits must be positive.'; errorEl.classList.add('visible'); } creditsValid = false; }
                else if (nextCredits < 6) { errorEl.textContent = '(Min. 6 credits recommended)'; errorEl.classList.add('visible'); }
                let cgpaValid = true;
                if (isNaN(targetCgpa) || targetCgpa > 4.00 || targetCgpa < 0.00) { resultEl.classList.add('hidden'); if (targetCgpaInput.value.trim() !== '') { if (targetCgpaErrorEl) { targetCgpaErrorEl.textContent = 'Aeh! 🙂'; targetCgpaErrorEl.classList.add('visible'); } } cgpaValid = false; }
                if (!creditsValid || !cgpaValid) return;
                const targetTotalPoints = targetCgpa * (calculationCache.totalGpaCredits + nextCredits);
                const requiredNextPoints = targetTotalPoints - calculationCache.currentTotalPoints;
                const requiredGpa = requiredNextPoints / nextCredits;
                resultEl.classList.remove('hidden');
                if (requiredGpa > 4.0) gpaEl.textContent = `Impossible (${requiredGpa.toFixed(2)})`;
                else if (requiredGpa < 0) gpaEl.textContent = `0.00 (F) or higher`;
                else gpaEl.textContent = requiredGpa.toFixed(2);
            };

            const handleRecoveryCalculation = (nextCreditsInput, resultEl, gpaEl, errorEl) => {
                const nextCredits = parseFloat(nextCreditsInput.value);
                errorEl.textContent = ''; errorEl.classList.remove('visible'); resultEl.classList.add('hidden');
                if (isNaN(nextCredits) || nextCredits <= 0) { if (nextCreditsInput.value.trim() !== '') { errorEl.textContent = 'Credits must be positive.'; errorEl.classList.add('visible'); } return; }
                if (nextCredits < 6) { errorEl.textContent = '(Min. 6 credits recommended)'; errorEl.classList.add('visible'); }
                const targetTotalPoints = 2.0 * (calculationCache.totalGpaCredits + nextCredits);
                const requiredNextPoints = targetTotalPoints - calculationCache.currentTotalPoints;
                const requiredGpa = requiredNextPoints / nextCredits;
                resultEl.classList.remove('hidden');
                if (requiredGpa > 4.0) gpaEl.textContent = `Impossible (${requiredGpa.toFixed(2)})`;
                else if (requiredGpa <= 1.0) gpaEl.textContent = 'Min. 1.00 (D)';
                else gpaEl.textContent = requiredGpa.toFixed(2);
            };
            
            // --- Game Logic --- //
            let isSnakeGameActive = false, wamGameActive = false, isBreakoutGameActive = false;
            let snakeGameLoop = null, wamGameTimer = null, wamMoleTimer = null, breakoutGameLoop = null, paddleMoveInterval = null;

            const selectGame = (gameKey) => {
                gameContainers.forEach(container => container.classList.toggle('active', container.id === `game-${gameKey}`));
                if (gameKey !== 'snake' && isSnakeGameActive) stopSnakeGame();
                if (gameKey !== 'whac-a-mole' && wamGameActive) stopWamGame();
                if (gameKey !== 'breakout' && isBreakoutGameActive) stopBreakoutGame();
                if (gameKey === 'snake') startSnakeGame();
                else if (gameKey === 'breakout') startBreakoutGame();
                gameSelectBtns.forEach(btn => {
                    btn.classList.toggle('btn-primary', btn.dataset.game === gameKey);
                    btn.classList.toggle('btn-neutral', btn.dataset.game !== gameKey);
                });
            };

            // Tic-Tac-Toe
            const tttBoard = getEl('tic-tac-toe-board'), tttCells = document.querySelectorAll('.ttt-cell'), tttStatus = getEl('ttt-status'), tttResetBtn = getEl('ttt-reset-btn');
            const TTT_PLAYER = 'X', TTT_BOT = 'O';
            let currentTTTPlayer, tttBoardState, tttGameActive;
            const tttWinningConditions = [ [0,1,2], [3,4,5], [6,7,8], [0,3,6], [1,4,7], [2,5,8], [0,4,8], [2,4,6] ];
            const handleTTTCellClick = (e) => {
                const cell = e.target.closest('.ttt-cell'); if (!cell || cell.classList.contains('disabled')) return;
                const index = parseInt(cell.dataset.index); if (tttBoardState[index] !== null || !tttGameActive || currentTTTPlayer !== TTT_PLAYER) return;
                makeTTTMove(index, TTT_PLAYER);
                if (checkTTTWin(TTT_PLAYER)) { tttStatus.textContent = `You win! 🎉`; tttGameActive = false; disableTTTBoard(); return; }
                else if (isTTTDraw()) { tttStatus.textContent = "It's a draw! 🤝"; tttGameActive = false; disableTTTBoard(); return; }
                switchTTTPlayer(TTT_BOT); setTimeout(botMove, 500);
            };
            const makeTTTMove = (index, player) => { tttBoardState[index] = player; const cell = tttCells[index]; cell.querySelector('span').textContent = player; cell.classList.add('occupied', player, 'disabled'); };
            const switchTTTPlayer = (nextPlayer) => { currentTTTPlayer = nextPlayer; tttStatus.textContent = nextPlayer === TTT_PLAYER ? "Your Turn (X)" : "Bot's Turn (O)"; if (nextPlayer === TTT_BOT) disableTTTBoard(false); else enableTTTBoard(); };
            const disableTTTBoard = (all = true) => tttCells.forEach(cell => { if (all || !cell.classList.contains('occupied')) cell.classList.add('disabled'); });
            const enableTTTBoard = () => tttCells.forEach(cell => { if (!cell.classList.contains('occupied')) cell.classList.remove('disabled'); });
            const botMove = () => { if (!tttGameActive || currentTTTPlayer !== TTT_BOT) return; let bestMove = findBestMove(); if (bestMove !== -1) { makeTTTMove(bestMove, TTT_BOT); if (checkTTTWin(TTT_BOT)) { tttStatus.textContent = `Bot wins! 🤖`; tttGameActive = false; disableTTTBoard(); return; } else if (isTTTDraw()) { tttStatus.textContent = "It's a draw! 🤝"; tttGameActive = false; disableTTTBoard(); return; } } switchTTTPlayer(TTT_PLAYER); };
            const findBestMove = () => { for (let i = 0; i < 9; i++) if (tttBoardState[i] === null) { tttBoardState[i] = TTT_BOT; if (checkTTTWin(TTT_BOT)) { tttBoardState[i] = null; return i; } tttBoardState[i] = null; } for (let i = 0; i < 9; i++) if (tttBoardState[i] === null) { tttBoardState[i] = TTT_PLAYER; if (checkTTTWin(TTT_PLAYER)) { tttBoardState[i] = null; return i; } tttBoardState[i] = null; } if (tttBoardState[4] === null) return 4; const corners = [0, 2, 6, 8], availableCorners = corners.filter(i => tttBoardState[i] === null); if (availableCorners.length > 0) return availableCorners[Math.floor(Math.random() * availableCorners.length)]; const availableCells = []; for (let i = 0; i < 9; i++) if (tttBoardState[i] === null) availableCells.push(i); if (availableCells.length > 0) return availableCells[Math.floor(Math.random() * availableCells.length)]; return -1; };
            const checkTTTWin = (player) => tttWinningConditions.some(c => c.every(i => tttBoardState[i] === player));
            const isTTTDraw = () => tttBoardState.every(cell => cell !== null);
            const resetTTTGame = () => { tttBoardState = Array(9).fill(null); tttGameActive = true; currentTTTPlayer = TTT_PLAYER; tttCells.forEach(cell => { cell.querySelector('span').textContent = 'X'; cell.classList.remove('occupied', 'X', 'O', 'disabled'); }); tttStatus.textContent = `Your Turn (X)`; enableTTTBoard(); };
            const initializeTTTGame = () => { tttBoard.addEventListener('click', handleTTTCellClick); tttResetBtn.addEventListener('click', resetTTTGame); resetTTTGame(); };

            // Memory Match
            const memoryBoard = getEl('memory-board'), memoryStatus = getEl('memory-status'), memoryResetBtn = getEl('memory-reset-btn'), memoryDifficultySelect = getEl('memory-difficulty-select');
            const memoryAllEmojis = ['🎓', '💻', '📚', '💡', '🧪', '📈', '🚀', '🧠', '🧩', '🏆'];
            const memoryDifficultySettings = { easy: { pairs: 6, cols: 4 }, medium: { pairs: 8, cols: 4 }, hard: { pairs: 10, cols: 5 } };
            let currentMemoryDifficulty = 'easy', memoryCards, flippedCards, matchedPairs, memoryMoves, canFlip;
            const startMemoryGame = () => { const settings = memoryDifficultySettings[currentMemoryDifficulty]; const emojis = memoryAllEmojis.slice(0, settings.pairs); memoryCards = shuffle([...emojis, ...emojis]); flippedCards = []; matchedPairs = 0; memoryMoves = 0; canFlip = true; memoryStatus.textContent = "Moves: 0"; memoryBoard.innerHTML = ''; memoryBoard.style.gridTemplateColumns = `repeat(${settings.cols}, 1fr)`; memoryCards.forEach((emoji, index) => { const card = document.createElement('div'); card.className = 'memory-card'; card.dataset.index = index; card.innerHTML = `<div class="memory-card-face memory-card-front">${emoji}</div><div class="memory-card-face memory-card-back"><i data-lucide="help-circle"></i></div>`; card.addEventListener('click', () => flipMemoryCard(card, emoji)); memoryBoard.appendChild(card); }); if (lucide && typeof lucide.createIcons === 'function') { lucide.createIcons(); } };
            const flipMemoryCard = (card, emoji) => { if (!canFlip || card.classList.contains('is-flipped') || card.classList.contains('is-matched')) return; card.classList.add('is-flipped'); flippedCards.push({ card, emoji }); if (flippedCards.length === 2) { canFlip = false; memoryMoves++; memoryStatus.textContent = `Moves: ${memoryMoves}`; checkForMemoryMatch(); } };
            const checkForMemoryMatch = () => { const [first, second] = flippedCards; if (first.emoji === second.emoji) disableMemoryCards(first.card, second.card); else unflipMemoryCards(first.card, second.card); };
            const disableMemoryCards = (c1, c2) => { c1.classList.add('is-matched'); c2.classList.add('is-matched'); matchedPairs++; flippedCards = []; canFlip = true; if (matchedPairs === memoryDifficultySettings[currentMemoryDifficulty].pairs) setTimeout(() => memoryStatus.textContent = `You won in ${memoryMoves} moves! 🎉`, 500); };
            const unflipMemoryCards = (c1, c2) => setTimeout(() => { c1.classList.remove('is-flipped'); c2.classList.remove('is-flipped'); flippedCards = []; canFlip = true; }, 1000);
            const initializeMemoryGame = () => { memoryResetBtn.addEventListener('click', startMemoryGame); memoryDifficultySelect.addEventListener('click', (e) => { const btn = e.target.closest('button'); if (!btn || !btn.dataset.difficulty) return; currentMemoryDifficulty = btn.dataset.difficulty; memoryDifficultySelect.querySelectorAll('button').forEach(b => { b.classList.remove('btn-primary'); b.classList.add('btn-neutral'); }); btn.classList.add('btn-primary'); btn.classList.remove('btn-neutral'); startMemoryGame(); }); startMemoryGame(); };

            // Snake Game
            const snakeCanvas = getEl('snake-canvas'), snakeCtx = snakeCanvas.getContext('2d'), snakeStatus = getEl('game-status-snake'), snakeResetBtn = getEl('snake-reset-btn');
            const snakeGridSize = 20; let snake, food, score, direction, gameSpeed;
            const resetSnakeGame = () => { snake = [{ x: 10, y: 10 }]; food = getRandomFoodPos(); score = 0; direction = 'right'; gameSpeed = 150; snakeStatus.textContent = `Score: 0`; if (snakeGameLoop) clearInterval(snakeGameLoop); snakeGameLoop = null; isSnakeGameActive = false; };
            const startSnakeGame = () => { if (isSnakeGameActive && snakeGameLoop) return; resetSnakeGame(); isSnakeGameActive = true; document.addEventListener('keydown', handleSnakeKeyInput); snakeGameLoop = setInterval(snakeGameLoopFunction, gameSpeed); };
            const stopSnakeGame = () => { isSnakeGameActive = false; if (snakeGameLoop) clearInterval(snakeGameLoop); snakeGameLoop = null; document.removeEventListener('keydown', handleSnakeKeyInput); };
            const getRandomFoodPos = () => ({ x: Math.floor(Math.random() * (snakeCanvas.width / snakeGridSize)), y: Math.floor(Math.random() * (snakeCanvas.height / snakeGridSize)) });
            const drawSnake = () => { if (!isSnakeGameActive) return; snakeCtx.fillStyle = body.dataset.theme === 'dark' ? 'rgba(26, 26, 26, 0.7)' : '#fdfdff'; snakeCtx.fillRect(0, 0, snakeCanvas.width, snakeCanvas.height); snakeCtx.fillStyle = '#e53e3e'; snakeCtx.fillRect(food.x * snakeGridSize, food.y * snakeGridSize, snakeGridSize, snakeGridSize); snake.forEach((segment, index) => { snakeCtx.fillStyle = index === 0 ? '#4f46e5' : '#6366f1'; snakeCtx.fillRect(segment.x * snakeGridSize, segment.y * snakeGridSize, snakeGridSize, snakeGridSize); snakeCtx.strokeStyle = body.dataset.theme === 'dark' ? '#1a1a1a' : '#fff'; snakeCtx.strokeRect(segment.x * snakeGridSize, segment.y * snakeGridSize, snakeGridSize, snakeGridSize); }); };
            const updateSnake = () => { if (!isSnakeGameActive) return; const head = { ...snake[0] }; switch (direction) { case 'up': head.y--; break; case 'down': head.y++; break; case 'left': head.x--; break; case 'right': head.x++; break; } if (head.x < 0 || head.x >= snakeCanvas.width / snakeGridSize || head.y < 0 || head.y >= snakeCanvas.height / snakeGridSize) { gameOverSnake(); return; } for (let i = 1; i < snake.length; i++) if (head.x === snake[i].x && head.y === snake[i].y) { gameOverSnake(); return; } snake.unshift(head); if (head.x === food.x && head.y === food.y) { score++; snakeStatus.textContent = `Score: ${score}`; food = getRandomFoodPos(); } else snake.pop(); };
            const gameOverSnake = () => { stopSnakeGame(); snakeStatus.textContent = `Game Over! Score: ${score}`; };
            const snakeGameLoopFunction = () => { if (!isSnakeGameActive) return; updateSnake(); drawSnake(); };
            const handleSnakeKeyInput = (e) => { const key = e.key; let changed = false; if ((key === 'ArrowUp' || key === 'w') && direction !== 'down') { direction = 'up'; changed = true; } else if ((key === 'ArrowDown' || key === 's') && direction !== 'up') { direction = 'down'; changed = true; } else if ((key === 'ArrowLeft' || key === 'a') && direction !== 'right') { direction = 'left'; changed = true; } else if ((key === 'ArrowRight' || key === 'd') && direction !== 'left') { direction = 'right'; changed = true; } if (changed) e.preventDefault(); };
            const initializeSnakeGame = () => { snakeResetBtn.addEventListener('click', startSnakeGame); getEl('snake-up').addEventListener('click', () => { if(direction !== 'down') direction = 'up'; }); getEl('snake-down').addEventListener('click', () => { if(direction !== 'up') direction = 'down'; }); getEl('snake-left').addEventListener('click', () => { if(direction !== 'right') direction = 'left'; }); getEl('snake-right').addEventListener('click', () => { if(direction !== 'left') direction = 'right'; }); resetSnakeGame(); };

            // Whac-A-Mole
            const wamBoard = getEl('wam-board'), wamStatus = getEl('game-status-wam'), wamTimer = getEl('game-status-timer-wam'), wamStartBtn = getEl('wam-start-btn');
            let wamScore, wamTimeLeft, wamHoles = [];
            const initializeWamGame = () => { wamBoard.innerHTML = ''; wamHoles = []; for (let i = 0; i < 9; i++) { const hole = document.createElement('div'); hole.className = 'wam-hole'; const mole = document.createElement('div'); mole.className = 'wam-mole'; mole.textContent = '😵'; hole.appendChild(mole); wamBoard.appendChild(hole); wamHoles.push(mole); } wamStartBtn.addEventListener('click', startWamGame); wamBoard.addEventListener('click', whackMole); wamStatus.textContent = '0'; wamTimer.textContent = 'Time: 30s'; wamStartBtn.disabled = false; wamStartBtn.classList.remove('opacity-50', 'cursor-not-allowed'); wamStartBtn.innerHTML = '<i data-lucide="play" class="w-5 h-5"></i>Start Game'; if (lucide && typeof lucide.createIcons === 'function') { lucide.createIcons(); } };
            const startWamGame = () => { if (wamGameActive) return; wamScore = 0; wamTimeLeft = 30; wamGameActive = true; wamStatus.textContent = wamScore; wamTimer.textContent = `Time: ${wamTimeLeft}s`; wamStartBtn.disabled = true; wamStartBtn.classList.add('opacity-50', 'cursor-not-allowed'); wamStartBtn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i>Playing...'; if (lucide && typeof lucide.createIcons === 'function') { lucide.createIcons(); } wamGameTimer = setInterval(() => { wamTimeLeft--; wamTimer.textContent = `Time: ${wamTimeLeft}s`; if (wamTimeLeft <= 0) stopWamGame(); }, 1000); popMole(); };
            const stopWamGame = () => { wamGameActive = false; if (wamGameTimer) clearInterval(wamGameTimer); if (wamMoleTimer) clearTimeout(wamMoleTimer); wamGameTimer = null; wamMoleTimer = null; wamTimer.textContent = `Game Over! Final Score: ${wamScore}`; wamStartBtn.disabled = false; wamStartBtn.classList.remove('opacity-50', 'cursor-not-allowed'); wamStartBtn.innerHTML = '<i data-lucide="play" class="w-5 h-5"></i>Start Game'; if (lucide && typeof lucide.createIcons === 'function') { lucide.createIcons(); } wamHoles.forEach(mole => mole.classList.remove('up')); };
            const popMole = () => { if (!wamGameActive) return; wamHoles.forEach(mole => mole.classList.remove('up')); const randomHole = wamHoles[Math.floor(Math.random() * wamHoles.length)]; randomHole.classList.add('up'); const upTime = Math.random() * (1000 - 400) + 400; setTimeout(() => { if(wamGameActive) randomHole.classList.remove('up'); }, upTime); const nextPopTime = Math.random() * (1000 - 300) + 300; wamMoleTimer = setTimeout(() => { if (wamGameActive) popMole(); }, nextPopTime); };
            const whackMole = (e) => { if (!wamGameActive) return; const hole = e.target.closest('.wam-hole'); if (!hole) return; const mole = hole.querySelector('.wam-mole'); if (mole && mole.classList.contains('up')) { wamScore++; wamStatus.textContent = wamScore; mole.classList.remove('up'); } };
            
            // Word Guess
            const wgStatus = getEl('wg-status'), wgWordDisplay = getEl('wg-word-display'), wgGuessedLettersEl = getEl('wg-guessed-letters'), wgInputArea = getEl('wg-input-area'), wgLetterInput = getEl('wg-letter-input'), wgResetBtn = getEl('wg-reset-btn');
            const wgWordList = ['APPLE', 'BANANA', 'ORANGE', 'GRAPE', 'LEMON', 'MANGO', 'PEACH', 'BERRY', 'CHERRY', 'PLUM', 'HOUSE', 'TABLE', 'CHAIR', 'LIGHT', 'FLOOR', 'DOOR', 'WINDOW', 'ROOF', 'GARDEN', 'WATER', 'CLOUD', 'FLOWER', 'TREE', 'GRASS', 'STONE', 'RIVER', 'OCEAN', 'BEACH', 'MOUNTAIN', 'VALLEY', 'SUNNY', 'HAPPY', 'MUSIC', 'DANCE', 'SMILE', 'LAUGH', 'FRIEND', 'FAMILY', 'SCHOOL', 'STUDY', 'LEARN', 'TEACH', 'WRITE', 'READ', 'SPEAK', 'LISTEN', 'COMPUTER', 'PHONE', 'EMAIL', 'BUTTON'];
            let wgTargetWord, wgWordState, wgGuessedLetters, wgGuessesLeft, wgGameActive;
            const startWordGuessGame = () => { wgGameActive = true; wgGuessesLeft = 6; wgGuessedLetters = []; wgTargetWord = wgWordList[Math.floor(Math.random() * wgWordList.length)]; wgWordState = Array(wgTargetWord.length).fill('_'); let lettersToReveal = wgTargetWord.length <= 4 ? 1 : wgTargetWord.length <= 7 ? 2 : 3; const indices = Array.from(Array(wgTargetWord.length).keys()); shuffle(indices); for (let i = 0; i < lettersToReveal; i++) { const revealIndex = indices[i]; wgWordState[revealIndex] = wgTargetWord[revealIndex]; if (!wgGuessedLetters.includes(wgTargetWord[revealIndex])) wgGuessedLetters.push(wgTargetWord[revealIndex]); } wgStatus.textContent = `Guesses left: ${wgGuessesLeft}`; wgStatus.classList.remove('text-green-500', 'text-red-500'); wgGuessedLettersEl.textContent = `Guessed: ${wgGuessedLetters.join(', ')}`; wgInputArea.style.display = 'flex'; wgLetterInput.value = ''; wgLetterInput.disabled = false; updateWordDisplay(); };
            const updateWordDisplay = () => { wgWordDisplay.innerHTML = ''; wgWordState.forEach(letter => { const letterEl = document.createElement('div'); letterEl.className = 'wg-letter'; letterEl.textContent = letter; wgWordDisplay.appendChild(letterEl); }); };
            const handleWordGuess = (e) => { e.preventDefault(); if (!wgGameActive) return; const letter = wgLetterInput.value.toUpperCase(); wgLetterInput.value = ''; if (!letter || letter.length !== 1 || !/[A-Z]/.test(letter)) { showNotification("Please enter a single letter.", "error"); return; } if (wgGuessedLetters.includes(letter)) { showNotification("You already guessed that letter.", "error"); return; } wgGuessedLetters.push(letter); wgGuessedLettersEl.textContent = `Guessed: ${wgGuessedLetters.join(', ')}`; if (wgTargetWord.includes(letter)) { let correct = false; for (let i = 0; i < wgTargetWord.length; i++) if (wgTargetWord[i] === letter) { wgWordState[i] = letter; correct = true; } if (correct) updateWordDisplay(); } else { wgGuessesLeft--; wgStatus.textContent = `Guesses left: ${wgGuessesLeft}`; } checkWordGuessWinLoss(); };
            const checkWordGuessWinLoss = () => { if (wgWordState.join('') === wgTargetWord) { wgStatus.textContent = "You win! 🎉"; wgStatus.classList.add('text-green-500'); wgGameActive = false; wgInputArea.style.display = 'none'; wgLetterInput.disabled = true; } else if (wgGuessesLeft <= 0) { wgStatus.textContent = `You lose! The word was: ${wgTargetWord}`; wgStatus.classList.add('text-red-500'); wgGameActive = false; wgInputArea.style.display = 'none'; wgLetterInput.disabled = true; } };
            const initializeWordGuessGame = () => { wgInputArea.addEventListener('submit', handleWordGuess); wgResetBtn.addEventListener('click', startWordGuessGame); startWordGuessGame(); };

            // Breakout Game
            const breakoutCanvas = getEl('breakout-canvas'), breakoutCtx = breakoutCanvas.getContext('2d'), breakoutScoreEl = getEl('breakout-score'), breakoutLivesEl = getEl('breakout-lives'), breakoutResetBtn = getEl('breakout-reset-btn'), breakoutLeftBtn = getEl('breakout-left'), breakoutRightBtn = getEl('breakout-right');
            let ballRadius = 8, ballX, ballY, ballDX, ballDY, paddleHeight = 10, paddleWidth = 75, paddleX, paddleSpeed = 7, isMovingLeft = false, isMovingRight = false;
            let brickRowCount = 5, brickColumnCount = 7, brickWidth = 55, brickHeight = 15, brickPadding = 5, brickOffsetTop = 30, brickOffsetLeft = 30, bricks = [];
            const BONUS_BRICK_COUNT = 3, BONUS_POINTS = 5, NORMAL_POINTS = 1;
            function initializeBricks() { bricks = []; let bonusPlaced = 0, totalBricks = brickColumnCount * brickRowCount; for (let c = 0; c < brickColumnCount; c++) { bricks[c] = []; for (let r = 0; r < brickRowCount; r++) { let isBonus = false; if (bonusPlaced < BONUS_BRICK_COUNT && Math.random() < (BONUS_BRICK_COUNT - bonusPlaced) / (totalBricks - (c * brickRowCount + r))) { isBonus = true; bonusPlaced++; } bricks[c][r] = { x: 0, y: 0, status: 1, bonus: isBonus }; } } while (bonusPlaced < BONUS_BRICK_COUNT) { let c = Math.floor(Math.random() * brickColumnCount), r = Math.floor(Math.random() * brickRowCount); if (bricks[c] && bricks[c][r] && !bricks[c][r].bonus) { bricks[c][r].bonus = true; bonusPlaced++; } } }
            function resetBreakoutGame() { breakoutScore = 0; lives = 3; ballX = breakoutCanvas.width / 2; ballY = breakoutCanvas.height - 30; ballDX = 2.5; ballDY = -2.5; paddleX = (breakoutCanvas.width - paddleWidth) / 2; initializeBricks(); breakoutScoreEl.textContent = `Score: ${breakoutScore}`; breakoutLivesEl.textContent = `Lives: ${lives}`; if (breakoutGameLoop) cancelAnimationFrame(breakoutGameLoop); breakoutGameLoop = null; isBreakoutGameActive = false; isMovingLeft = false; isMovingRight = false; if (paddleMoveInterval) clearInterval(paddleMoveInterval); paddleMoveInterval = null; }
            function startBreakoutGame() { if (isBreakoutGameActive && breakoutGameLoop) return; resetBreakoutGame(); isBreakoutGameActive = true; breakoutCanvas.addEventListener('mousemove', handleBreakoutMouseMove); breakoutCanvas.addEventListener('touchmove', handleBreakoutTouchMove, { passive: false }); breakoutCanvas.addEventListener('touchstart', handleBreakoutTouchMove, { passive: false }); breakoutLeftBtn.addEventListener('touchstart', () => isMovingLeft = true, { passive: true }); breakoutLeftBtn.addEventListener('touchend', () => isMovingLeft = false); breakoutRightBtn.addEventListener('touchstart', () => isMovingRight = true, { passive: true }); breakoutRightBtn.addEventListener('touchend', () => isMovingRight = false); breakoutLeftBtn.addEventListener('mousedown', () => isMovingLeft = true); breakoutLeftBtn.addEventListener('mouseup', () => isMovingLeft = false); breakoutLeftBtn.addEventListener('mouseleave', () => isMovingLeft = false); breakoutRightBtn.addEventListener('mousedown', () => isMovingRight = true); breakoutRightBtn.addEventListener('mouseup', () => isMovingRight = false); breakoutRightBtn.addEventListener('mouseleave', () => isMovingRight = false); paddleMoveInterval = setInterval(movePaddleWithButtons, 20); breakoutGameLoop = requestAnimationFrame(drawBreakout); }
            function stopBreakoutGame() { isBreakoutGameActive = false; if (breakoutGameLoop) cancelAnimationFrame(breakoutGameLoop); breakoutGameLoop = null; if (paddleMoveInterval) clearInterval(paddleMoveInterval); paddleMoveInterval = null; isMovingLeft = false; isMovingRight = false; breakoutCanvas.removeEventListener('mousemove', handleBreakoutMouseMove); breakoutCanvas.removeEventListener('touchmove', handleBreakoutTouchMove); breakoutCanvas.removeEventListener('touchstart', handleBreakoutTouchMove); }
            function movePaddleWithButtons() { if (!isBreakoutGameActive) return; if (isMovingLeft) { paddleX -= paddleSpeed; if (paddleX < 0) paddleX = 0; } else if (isMovingRight) { paddleX += paddleSpeed; if (paddleX + paddleWidth > breakoutCanvas.width) paddleX = breakoutCanvas.width - paddleWidth; } }
            function drawBall() { breakoutCtx.beginPath(); breakoutCtx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2); breakoutCtx.fillStyle = '#4f46e5'; breakoutCtx.fill(); breakoutCtx.closePath(); }
            function drawPaddle() { breakoutCtx.beginPath(); breakoutCtx.rect(paddleX, breakoutCanvas.height - paddleHeight, paddleWidth, paddleHeight); breakoutCtx.fillStyle = '#10b981'; breakoutCtx.fill(); breakoutCtx.closePath(); }
            function drawBricks() { const brickColors = ['#ef4444', '#f59e0b', '#84cc16', '#22c55e', '#0ea5e9'], bonusColor = '#FFD700'; for (let c = 0; c < brickColumnCount; c++) for (let r = 0; r < brickRowCount; r++) if (bricks[c][r].status === 1) { let bX = c * (brickWidth + brickPadding) + brickOffsetLeft, bY = r * (brickHeight + brickPadding) + brickOffsetTop; bricks[c][r].x = bX; bricks[c][r].y = bY; breakoutCtx.beginPath(); breakoutCtx.rect(bX, bY, brickWidth, brickHeight); breakoutCtx.fillStyle = bricks[c][r].bonus ? bonusColor : brickColors[r % brickColors.length]; breakoutCtx.fill(); breakoutCtx.closePath(); } }
            function collisionDetection() { for (let c = 0; c < brickColumnCount; c++) for (let r = 0; r < brickRowCount; r++) { let b = bricks[c][r]; if (b.status === 1 && ballX + ballRadius > b.x && ballX - ballRadius < b.x + brickWidth && ballY + ballRadius > b.y && ballY - ballRadius < b.y + brickHeight) { ballDY = -ballDY; b.status = 0; breakoutScore += b.bonus ? BONUS_POINTS : NORMAL_POINTS; breakoutScoreEl.textContent = `Score: ${breakoutScore}`; if (b.bonus) showNotification(`+${BONUS_POINTS} Bonus!`, 'success'); let remaining = 0; for(let col=0; col<brickColumnCount; col++) for(let row=0; row<brickRowCount; row++) if (bricks[col][row].status===1) remaining++; if (remaining === 0) { breakoutScoreEl.textContent = `YOU WIN! Score: ${breakoutScore}`; stopBreakoutGame(); } } } }
            function drawBreakout() { if (!isBreakoutGameActive) return; breakoutCtx.clearRect(0, 0, breakoutCanvas.width, breakoutCanvas.height); drawBricks(); drawBall(); drawPaddle(); collisionDetection(); if (ballX + ballDX > breakoutCanvas.width - ballRadius || ballX + ballDX < ballRadius) ballDX = -ballDX; if (ballY + ballDY < ballRadius) ballDY = -ballDY; else if (ballY + ballDY > breakoutCanvas.height - ballRadius - paddleHeight) if (ballX > paddleX && ballX < paddleX + paddleWidth) { let cP = (ballX - (paddleX + paddleWidth / 2)) / (paddleWidth / 2), angle = cP * (Math.PI / 3); ballDX = 3 * Math.sin(angle); ballDY = -3 * Math.cos(angle); } else { lives--; breakoutLivesEl.textContent = `Lives: ${lives}`; if (lives <= 0) { breakoutScoreEl.textContent = `GAME OVER! Score: ${breakoutScore}`; stopBreakoutGame(); } else { ballX = breakoutCanvas.width / 2; ballY = breakoutCanvas.height - 30; ballDX = 2.5 * (Math.random() < 0.5 ? 1 : -1); ballDY = -2.5; paddleX = (breakoutCanvas.width - paddleWidth) / 2; } } ballX += ballDX; ballY += ballDY; breakoutGameLoop = requestAnimationFrame(drawBreakout); }
            function handleBreakoutMouseMove(e) { let rX = e.clientX - breakoutCanvas.getBoundingClientRect().left; if (rX > paddleWidth / 2 && rX < breakoutCanvas.width - paddleWidth / 2) paddleX = rX - paddleWidth / 2; else if (rX <= paddleWidth/2) paddleX = 0; else paddleX = breakoutCanvas.width - paddleWidth; }
            function handleBreakoutTouchMove(e) { e.preventDefault(); let touch = e.changedTouches[0], rX = touch.clientX - breakoutCanvas.getBoundingClientRect().left; if (rX > paddleWidth / 2 && rX < breakoutCanvas.width - paddleWidth / 2) paddleX = rX - paddleWidth / 2; else if (rX <= paddleWidth/2) paddleX = 0; else paddleX = breakoutCanvas.width - paddleWidth; }
            const initializeBreakoutGame = () => { breakoutResetBtn.addEventListener('click', startBreakoutGame); resetBreakoutGame(); };
            

            // --- Event Listeners (Combined) --- //
            // Calculator Listeners
            if (themeToggle) {
                themeToggle.addEventListener('change', () => updateTheme(themeToggle.checked));
            }
            [currentCgpaInput, completedCreditsInput, completedEarnedCreditsInput].forEach(el => el.addEventListener('input', saveState));
            addCourseForm.addEventListener('submit', (e) => { e.preventDefault(); const c = courseCreditEl.value, g = courseGradeEl.value; if (!c || !g) { showNotification("Please select both credit and grade.", 'error'); return; } courses.push({ type: 'new', credit: parseFloat(c), grade: parseFloat(g) }); renderCourses(); hideResults(); saveState(); showNotification('Course added!'); courseCreditEl.value = ""; courseGradeEl.value = ""; });
            addRetakeForm.addEventListener('submit', (e) => { e.preventDefault(); const c = retakeCreditEl.value, oG = retakeOldGradeEl.value, nG = retakeNewGradeEl.value; if (!c || !oG || !nG) { showNotification("Please select all retake fields.", 'error'); return; } const credit = parseFloat(c), oldGrade = parseFloat(oG), newGrade = parseFloat(nG); if (oldGrade >= newGrade) { showNotification("New grade must be higher.", 'error'); return; } const hasInitial = (parseFloat(completedCreditsInput.value) || 0) > 0 && currentCgpaInput.value.trim() !== '' && (parseFloat(completedEarnedCreditsInput.value) || 0) >= 0 && completedEarnedCreditsInput.value.trim() !== ''; showNotification(hasInitial ? 'Retake course added!' : "Retake added. Enter Full Current Standing for best results.", hasInitial ? 'success' : 'warning'); courses.push({ type: 'retake', credit, oldGrade, newGrade }); renderCourses(); hideResults(); saveState(); retakeCreditEl.value = ""; retakeOldGradeEl.value = ""; retakeNewGradeEl.value = ""; });
            courseListContainer.addEventListener('click', (e) => { const removeBtn = e.target.closest('.remove-btn'); if (removeBtn) { courses.splice(parseInt(removeBtn.dataset.index), 1); renderCourses(); hideResults(); saveState(); } });
            calculateBtn.addEventListener('click', handleCalculation);
            resetBtn.addEventListener('click', () => { courses = []; currentCgpaInput.value = ''; completedCreditsInput.value = ''; completedEarnedCreditsInput.value = ''; renderCourses(); hideResults(); saveState(); showNotification('Calculator has been reset.', 'success'); });
            const nextCreditsInput = getEl('next-credits');
            nextCreditsInput.addEventListener('input', () => handleRecoveryCalculation(nextCreditsInput, getEl('recovery-result'), getEl('required-gpa'), getEl('next-credits-error')));
            ['good', 'mid'].forEach(s => { const tc = getEl(`target-cgpa-${s}`), tcr = getEl(`target-credits-${s}`); [tc, tcr].forEach(el => el.addEventListener('input', () => handleTargetCalculation(tc, tcr, getEl(`target-result-${s}`), getEl(`required-gpa-${s}`), getEl(`target-credits-${s}-error`)))); });
            
            // Game Modal Listeners
            openGameModalBtn.addEventListener('click', () => { gameModal.classList.add('show'); if (window.innerWidth < 1024) showNotification("Enjoy the games! (Best experience on PC)", "info"); if (lucide && typeof lucide.createIcons === 'function') { lucide.createIcons(); } });
            closeGameModalBtn.addEventListener('click', () => { gameModal.classList.remove('show'); if (isSnakeGameActive) stopSnakeGame(); if (wamGameActive) stopWamGame(); if (isBreakoutGameActive) stopBreakoutGame(); });
            gameSelection.addEventListener('click', (e) => { const btn = e.target.closest('.game-select-btn'); if (btn && btn.dataset.game) selectGame(btn.dataset.game); });

            // --- Initialization (Combined) --- //
            initializeTheme();
            loadState(); // Load calculator state
            initializeTTTGame();
            initializeMemoryGame();
            initializeSnakeGame();
            initializeWamGame();
            initializeWordGuessGame();
            initializeBreakoutGame();
            selectGame('tic-tac-toe'); // Set default game
            if (lucide && typeof lucide.createIcons === 'function') {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>
